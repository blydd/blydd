<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/5/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-线程池之 ThreadPoolExecutor" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/04/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%B9%8B%20ThreadPoolExecutor/" class="article-date">
  <time class="dt-published" datetime="2020-12-04T02:10:17.000Z" itemprop="datePublished">2020-12-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/04/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%B9%8B%20ThreadPoolExecutor/">线程池之ThreadPollExecutor</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="线程池之-ThreadPoolExecutor"><a href="#线程池之-ThreadPoolExecutor" class="headerlink" title="线程池之 ThreadPoolExecutor"></a>线程池之 ThreadPoolExecutor</h2><h3 id="线程池介绍"><a href="#线程池介绍" class="headerlink" title="线程池介绍"></a>线程池介绍</h3><p>线程池（Thread Pool）：把一个或多个线程通过统一的方式进行调度和重复使用的技术，避免了因为线程过多而带来使用上的开销。</p>
<h4 id="为什么要使用线程池？"><a href="#为什么要使用线程池？" class="headerlink" title="为什么要使用线程池？"></a>为什么要使用线程池？</h4><ul>
<li>可重复使用已有线程，避免对象创建、消亡和过度切换的性能开销。</li>
<li>避免创建大量同类线程所导致的资源过度竞争和内存溢出的问题。</li>
<li>支持更多功能，比如延迟任务线程池（newScheduledThreadPool）和缓存线程池（newCachedThreadPool）等。</li>
</ul>
<h3 id="线程池使用"><a href="#线程池使用" class="headerlink" title="线程池使用"></a>线程池使用</h3><p>创建线程池有两种方式：ThreadPoolExecutor 和 Executors，其中 Executors 又可以创建 6 种不同的线程池类型，会在下节讲，本节重点来看看 ThreadPoolExecutor 的使用。</p>
<h4 id="ThreadPoolExecutor-的使用"><a href="#ThreadPoolExecutor-的使用" class="headerlink" title="ThreadPoolExecutor 的使用"></a>ThreadPoolExecutor 的使用</h4><p>线程池使用代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ThreadPoolExecutor threadPoolExecutor = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">2</span>, <span class="number">10</span>, <span class="number">10L</span>, TimeUnit.SECONDS, <span class="keyword">new</span> LinkedBlockingQueue(<span class="number">100</span>));</span><br><span class="line">threadPoolExecutor.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 执行线程池</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Hello, Java.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>以上程序执行结果如下：</p>
<blockquote>
<p>Hello, Java.</p>
</blockquote>
<h4 id="ThreadPoolExecutor-参数说明"><a href="#ThreadPoolExecutor-参数说明" class="headerlink" title="ThreadPoolExecutor 参数说明"></a>ThreadPoolExecutor 参数说明</h4><p>ThreadPoolExecutor 构造方法有以下四个，如下图所示：</p>
<p><img src="http://59.110.212.214/upload/20200818_13415697.png"></p>
<p>其中最后一个构造方法有 7 个构造参数，包含了前三个方法的构造参数，这 7 个参数名称如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                          ThreadFactory threadFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">                          RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其代表的含义如下：</p>
<h5 id="①-corePoolSize"><a href="#①-corePoolSize" class="headerlink" title="① corePoolSize"></a>① corePoolSize</h5><p>线程池中的核心线程数，默认情况下核心线程一直存活在线程池中，如果将 ThreadPoolExecutor 的 allowCoreThreadTimeOut 属性设为 true，如果线程池一直闲置并超过了 keepAliveTime 所指定的时间，核心线程就会被终止。</p>
<h5 id="②-maximumPoolSize"><a href="#②-maximumPoolSize" class="headerlink" title="② maximumPoolSize"></a>② maximumPoolSize</h5><p>最大线程数，当线程不够时能够创建的最大线程数。</p>
<h5 id="③-keepAliveTime"><a href="#③-keepAliveTime" class="headerlink" title="③ keepAliveTime"></a>③ keepAliveTime</h5><p>线程池的闲置超时时间，默认情况下对非核心线程生效，如果闲置时间超过这个时间，非核心线程就会被回收。如果 ThreadPoolExecutor 的 allowCoreThreadTimeOut 设为 true 的时候，核心线程如果超过闲置时长也会被回收。</p>
<h5 id="④-unit"><a href="#④-unit" class="headerlink" title="④ unit"></a>④ unit</h5><p>配合 keepAliveTime 使用，用来标识 keepAliveTime 的时间单位。</p>
<h5 id="⑤-workQueue"><a href="#⑤-workQueue" class="headerlink" title="⑤ workQueue"></a>⑤ workQueue</h5><p>线程池中的任务队列，使用 execute() 或 submit() 方法提交的任务都会存储在此队列中。</p>
<h5 id="⑥-threadFactory"><a href="#⑥-threadFactory" class="headerlink" title="⑥ threadFactory"></a>⑥ threadFactory</h5><p>为线程池提供创建新线程的线程工厂。</p>
<h5 id="⑦-rejectedExecutionHandler"><a href="#⑦-rejectedExecutionHandler" class="headerlink" title="⑦ rejectedExecutionHandler"></a>⑦ rejectedExecutionHandler</h5><p>线程池任务队列超过最大值之后的拒绝策略，RejectedExecutionHandler 是一个接口，里面只有一个 rejectedExecution 方法，可在此方法内添加任务超出最大值的事件处理。ThreadPoolExecutor 也提供了 4 种默认的拒绝策略：</p>
<ul>
<li>new ThreadPoolExecutor.DiscardPolicy()：丢弃掉该任务，不进行处理</li>
<li>new ThreadPoolExecutor.DiscardOldestPolicy()：丢弃队列里最近的一个任务，并执行当前任务</li>
<li>new ThreadPoolExecutor.AbortPolicy()：直接抛出 RejectedExecutionException 异常</li>
<li>new ThreadPoolExecutor.CallerRunsPolicy()：既不抛弃任务也不抛出异常，直接使用主线程来执行此任务</li>
</ul>
<p>包含所有参数的 ThreadPoolExecutor 使用代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadPoolExecutorTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>&#123;</span><br><span class="line">        ThreadPoolExecutor threadPool = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                <span class="number">10L</span>, TimeUnit.SECONDS, <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;(<span class="number">2</span>),</span><br><span class="line">                <span class="keyword">new</span> MyThreadFactory(), <span class="keyword">new</span> ThreadPoolExecutor.CallerRunsPolicy());</span><br><span class="line">        threadPool.allowCoreThreadTimeOut(<span class="keyword">true</span>);<span class="comment">//核心线程如果超过闲置时长也会被回收</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            threadPool.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName());</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThreadFactory</span> <span class="keyword">implements</span> <span class="title">ThreadFactory</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> AtomicInteger count = <span class="keyword">new</span> AtomicInteger(<span class="number">0</span>);</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Thread <span class="title">newThread</span><span class="params">(Runnable r)</span> </span>&#123;</span><br><span class="line">        Thread t = <span class="keyword">new</span> Thread(r);</span><br><span class="line">        String threadName = <span class="string">&quot;MyThread&quot;</span> + count.addAndGet(<span class="number">1</span>);</span><br><span class="line">        t.setName(threadName);</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="线程池执行方法-execute-VS-submit"><a href="#线程池执行方法-execute-VS-submit" class="headerlink" title="线程池执行方法 execute() VS submit()"></a>线程池执行方法 execute() VS submit()</h4><p>execute() 和 submit() 都是用来执行线程池的，区别在于 submit() 方法可以接收线程池执行的返回值。</p>
<p>下面分别来看两个方法的具体使用和区别：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建线程池</span></span><br><span class="line">ThreadPoolExecutor threadPoolExecutor = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">2</span>, <span class="number">10</span>, <span class="number">10L</span>, TimeUnit.SECONDS, <span class="keyword">new</span> LinkedBlockingQueue(<span class="number">100</span>));</span><br><span class="line"><span class="comment">// execute 使用</span></span><br><span class="line">threadPoolExecutor.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello, Java.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// submit 使用</span></span><br><span class="line">Future&lt;String&gt; future = threadPoolExecutor.submit(<span class="keyword">new</span> Callable&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello, 老王.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">System.out.println(future.get());</span><br></pre></td></tr></table></figure>
<p>以上程序执行结果如下：</p>
<blockquote>
<p>Hello, Java.</p>
<p>Hello, 老王.</p>
<p>Success</p>
</blockquote>
<h4 id="线程池关闭"><a href="#线程池关闭" class="headerlink" title="线程池关闭"></a>线程池关闭</h4><p>线程池关闭，可以使用 shutdown() 或 shutdownNow() 方法，它们的区别是：</p>
<ul>
<li><strong>shutdown()：不会立即终止线程池，而是要等所有任务队列中的任务都执行完后才会终止。执行完 shutdown 方法之后，线程池就不会再接受新任务了。</strong></li>
<li>shutdownNow()：执行该方法，线程池的状态立刻变成 STOP 状态，并试图停止所有正在执行的线程，不再处理还在池队列中等待的任务，执行此方法会返回未执行的任务。</li>
</ul>
<p>下面用代码来模拟 shutdown() 之后，给线程池添加任务，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">threadPoolExecutor.execute(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;I&#x27;m &quot;</span> + i);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">threadPoolExecutor.shutdown();</span><br><span class="line">threadPoolExecutor.execute(() -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;I&#x27;m Java.&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>以上程序执行结果如下：</p>
<blockquote>
<p>I’m 0</p>
<p>Exception in thread “main” java.util.concurrent.RejectedExecutionException: Task com.interview.chapter5.Section2<code>$$Lambda$2</code>/1828972342@568db2f2 rejected from java.util.concurrent.ThreadPoolExecutor@378bf509[Shutting down, pool size = 1, active threads = 1, queued tasks = 0, completed tasks = 0]</p>
<p>I’m 1</p>
</blockquote>
<p>可以看出，shutdown() 之后就不会再接受新的任务了，不过之前的任务会被执行完成。</p>
<h3 id="相关面试题"><a href="#相关面试题" class="headerlink" title="相关面试题"></a>相关面试题</h3><h4 id="1-ThreadPoolExecutor-有哪些常用的方法？"><a href="#1-ThreadPoolExecutor-有哪些常用的方法？" class="headerlink" title="1.ThreadPoolExecutor 有哪些常用的方法？"></a>1.ThreadPoolExecutor 有哪些常用的方法？</h4><p>答：常用方法如下所示：</p>
<ul>
<li>submit()/execute()：执行线程池</li>
<li>shutdown()/shutdownNow()：终止线程池</li>
<li>isShutdown()：判断线程是否终止</li>
<li>getActiveCount()：正在运行的线程数</li>
<li>getCorePoolSize()：获取核心线程数</li>
<li>getMaximumPoolSize()：获取最大线程数</li>
<li>getQueue()：获取线程池中的任务队列</li>
<li>allowCoreThreadTimeOut(boolean)：设置空闲时是否回收核心线程</li>
</ul>
<h4 id="2-以下程序执行的结果是什么？"><a href="#2-以下程序执行的结果是什么？" class="headerlink" title="2.以下程序执行的结果是什么？"></a>2.以下程序执行的结果是什么？</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ThreadPoolExecutor threadPoolExecutor = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">2</span>, <span class="number">10</span>, <span class="number">10L</span>, TimeUnit.SECONDS, <span class="keyword">new</span> LinkedBlockingQueue());</span><br><span class="line">threadPoolExecutor.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;I：&quot;</span> + i);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">threadPoolExecutor.shutdownNow();</span><br><span class="line">System.out.println(<span class="string">&quot;Java&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>答：程序执行的结果是：</p>
<blockquote>
<p>I：0</p>
<p>Java</p>
<p>java.lang.InterruptedException: sleep interrupted（报错信息）</p>
<p>I：1</p>
</blockquote>
<p>题目解析：因为程序中使用了 <code>shutdownNow()</code> 会导致程序执行一次之后报错，抛出 <code>sleep interrupted</code> 异常，又因为本身有 try/catch，所以程序会继续执行打印 <code>I：1</code> 。</p>
<h4 id="3-在-ThreadPool-中-submit-和-execute-有什么区别？"><a href="#3-在-ThreadPool-中-submit-和-execute-有什么区别？" class="headerlink" title="3.在 ThreadPool 中 submit() 和 execute() 有什么区别？"></a>3.在 ThreadPool 中 submit() 和 execute() 有什么区别？</h4><p>答：submit() 和 execute() 都是用来执行线程池的，只不过使用 execute() 执行线程池不能有返回方法，而使用 submit() 可以使用 Future 接收线程池执行的返回值。</p>
<p>submit() 方法源码（JDK 8）如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public &lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task) &#123;</span><br><span class="line">    if (task &#x3D;&#x3D; null) throw new NullPointerException();</span><br><span class="line">    RunnableFuture&lt;T&gt; ftask &#x3D; newTaskFor(task);</span><br><span class="line">    execute(ftask);</span><br><span class="line">    return ftask;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>execute() 源码（JDK 8）如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public void execute(Runnable command) &#123;</span><br><span class="line">    if (command &#x3D;&#x3D; null)</span><br><span class="line">        throw new NullPointerException();</span><br><span class="line">    &#x2F;&#x2F;..... 其他</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-说一下-ThreadPoolExecutor-都需要哪些参数？"><a href="#4-说一下-ThreadPoolExecutor-都需要哪些参数？" class="headerlink" title="4.说一下 ThreadPoolExecutor 都需要哪些参数？"></a>4.说一下 ThreadPoolExecutor 都需要哪些参数？</h4><p>答：ThreadPoolExecutor 最多包含以下七个参数：</p>
<ul>
<li>corePoolSize：线程池中的核心线程数</li>
<li>maximumPoolSize：线程池中最大线程数</li>
<li>keepAliveTime：闲置超时时间</li>
<li>unit：keepAliveTime 超时时间的单位（时/分/秒等）</li>
<li>workQueue：线程池中的任务队列</li>
<li>threadFactory：为线程池提供创建新线程的线程工厂</li>
<li>rejectedExecutionHandler：线程池任务队列超过最大值之后的拒绝策略</li>
</ul>
<p>更多详细介绍，请见正文。</p>
<h4 id="5-在线程池中-shutdownNow-和-shutdown-有什么区别？"><a href="#5-在线程池中-shutdownNow-和-shutdown-有什么区别？" class="headerlink" title="5.在线程池中 shutdownNow() 和 shutdown() 有什么区别？"></a>5.在线程池中 shutdownNow() 和 shutdown() 有什么区别？</h4><p>答：shutdownNow() 和 shutdown() 都是用来终止线程池的，它们的区别是，使用 shutdown() 程序不会报错，也不会立即终止线程，它会等待线程池中的缓存任务执行完之后再退出，执行了 shutdown() 之后就不能给线程池添加新任务了；shutdownNow() 会试图立马停止任务，如果线程池中还有缓存任务正在执行，则会抛出 java.lang.InterruptedException: sleep interrupted 异常。</p>
<h4 id="6-说一说线程池的工作原理？"><a href="#6-说一说线程池的工作原理？" class="headerlink" title="6.说一说线程池的工作原理？"></a>6.说一说线程池的工作原理？</h4><p>答：当线程池中有任务需要执行时，线程池会判断如果线程数量没有超过核心数量就会新建线程池进行任务执行，如果线程池中的线程数量已经超过核心线程数，这时候任务就会被放入任务队列中排队等待执行；如果任务队列超过最大队列数，并且线程池没有达到最大线程数，就会新建线程来执行任务；如果超过了最大线程数，就会执行拒绝执行策略。</p>
<h4 id="7-以下线程名称被打印了几次？"><a href="#7-以下线程名称被打印了几次？" class="headerlink" title="7.以下线程名称被打印了几次？"></a>7.以下线程名称被打印了几次？</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ThreadPoolExecutor threadPool = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                <span class="number">10L</span>, TimeUnit.SECONDS, <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;(<span class="number">2</span>),</span><br><span class="line">                <span class="keyword">new</span> ThreadPoolExecutor.DiscardPolicy());</span><br><span class="line">threadPool.allowCoreThreadTimeOut(<span class="keyword">true</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    threadPool.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="comment">// 打印线程名称</span></span><br><span class="line">            System.out.println(Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>答：线程名被打印了 3 次。<br>题目解析：线程池第 1 次执行任务时，会新创建任务并执行；第 2 次执行任务时，因为没有空闲线程所以会把任务放入队列；第 3 次同样把任务放入队列，因为队列最多可以放两条数据，所以第 4 次之后的执行都会被舍弃（没有定义拒绝策略），于是就打印了 3 次线程名称。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>ThreadPoolExecutor 是创建线程池最传统和最推荐使用的方式，创建时要设置线程池的核心线程数和最大线程数还有任务队列集合，如果任务量大于队列的最大长度，线程池会先判断当前线程数量是否已经到达最大线程数，如果没有达到最大线程数就新建线程来执行任务，如果已经达到最大线程数，就会执行拒绝策略（拒绝策略可自行定义）。线程池可通过 submit() 来调用执行，从而获得线程执行的结果，也可以通过 shutdown() 来终止线程池。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/vipstone/java-interview/tree/master/interview-code/src/main/java/com/interview">点击此处下载本文源码</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/04/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%B9%8B%20ThreadPoolExecutor/" data-id="ckke5nr43003ocl8ghp7behv6" data-title="线程池之ThreadPollExecutor" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/threadPollExecutor/" rel="tag">threadPollExecutor</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/" rel="tag">线程池</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-自定义插入数据主键ID" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/04/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%E4%B8%BB%E9%94%AEID/" class="article-date">
  <time class="dt-published" datetime="2020-12-04T02:10:17.000Z" itemprop="datePublished">2020-12-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/04/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%E4%B8%BB%E9%94%AEID/">mybatis自定义插入主键</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p><strong>Order这个属性设为after,before这个执行顺序都是相对于下面的insert into这个sql的;<br>Order设为before:那么就先执行selectkey这个标签的sgl,再将这条sql生成的uuid set到User里面去,然后再执行insert into将这个已经带uuid为id的这个User insert到数据库中.</strong></p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--自增主键之UUID--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.test.mybatis.po.User&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--只要不是自增主键,那么order都设置为before--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">selectkey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">resultrype</span>=<span class="string">&quot;string&quot;</span> <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span>&gt;</span></span><br><span class="line">  	SELECT UUID()</span><br><span class="line">  <span class="tag">&lt;/<span class="name">selectkey</span>&gt;</span></span><br><span class="line">  INSERT INTO USER (ID,USERNAME,BIRTHDAY,SEX,ADDRESS)</span><br><span class="line">  VALUES (#&#123;id&#125;,#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/04/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%E4%B8%BB%E9%94%AEID/" data-id="ckke5nr44003scl8g5rvpds2a" data-title="mybatis自定义插入主键" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mybatis/" rel="tag">mybatis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xml/" rel="tag">xml</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%B8%BB%E9%94%AE/" rel="tag">主键</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-获取HttpServletRequest" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/04/%E8%8E%B7%E5%8F%96HttpServletRequest/" class="article-date">
  <time class="dt-published" datetime="2020-12-04T02:10:17.000Z" itemprop="datePublished">2020-12-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/04/%E8%8E%B7%E5%8F%96HttpServletRequest/">获取httpServerletRequest</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mmile.studysb.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取HttpServletRequest</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpContextUtils</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpServletRequest <span class="title">getHttpServletRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/04/%E8%8E%B7%E5%8F%96HttpServletRequest/" data-id="ckke5nr44003wcl8gezc70mjq" data-title="获取httpServerletRequest" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/httpServerletRequest/" rel="tag">httpServerletRequest</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-获取ip地址工具类" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/04/%E8%8E%B7%E5%8F%96ip%E5%9C%B0%E5%9D%80%E5%B7%A5%E5%85%B7%E7%B1%BB/" class="article-date">
  <time class="dt-published" datetime="2020-12-04T02:10:17.000Z" itemprop="datePublished">2020-12-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E5%85%B7%E7%B1%BB/">工具类</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/04/%E8%8E%B7%E5%8F%96ip%E5%9C%B0%E5%9D%80%E5%B7%A5%E5%85%B7%E7%B1%BB/">获取ip地址工具类</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mmile.studysb.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IPUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取IP地址</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 使用Nginx等反向代理软件， 则不能通过request.getRemoteAddr()获取IP地址</span></span><br><span class="line"><span class="comment">     * 如果使用了多级反向代理的话，X-Forwarded-For的值并不止一个，而是一串IP地址，X-Forwarded-For中第一个非unknown的有效IP字符串，则为真实IP地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getIpAddr</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String ip = request.getHeader(<span class="string">&quot;x-forwarded-for&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (ip == <span class="keyword">null</span> || ip.length() == <span class="number">0</span> || <span class="string">&quot;unknown&quot;</span>.equalsIgnoreCase(ip)) &#123;</span><br><span class="line">            ip = request.getHeader(<span class="string">&quot;Proxy-Client-IP&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ip == <span class="keyword">null</span> || ip.length() == <span class="number">0</span> || <span class="string">&quot;unknown&quot;</span>.equalsIgnoreCase(ip)) &#123;</span><br><span class="line">            ip = request.getHeader(<span class="string">&quot;WL-Proxy-Client-IP&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ip == <span class="keyword">null</span> || ip.length() == <span class="number">0</span> || <span class="string">&quot;unknown&quot;</span>.equalsIgnoreCase(ip)) &#123;</span><br><span class="line">            ip = request.getRemoteAddr();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;0:0:0:0:0:0:0:1&quot;</span>.equals(ip) ? <span class="string">&quot;127.0.0.1&quot;</span> : ip;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/04/%E8%8E%B7%E5%8F%96ip%E5%9C%B0%E5%9D%80%E5%B7%A5%E5%85%B7%E7%B1%BB/" data-id="ckke5nr450040cl8g23o18glu" data-title="获取ip地址工具类" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ip/" rel="tag">ip</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tool/" rel="tag">tool</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7%E7%B1%BB/" rel="tag">工具类</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-读取配置文件工具类" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/04/%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%B7%A5%E5%85%B7%E7%B1%BB/" class="article-date">
  <time class="dt-published" datetime="2020-12-04T02:10:17.000Z" itemprop="datePublished">2020-12-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E5%85%B7%E7%B1%BB/">工具类</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/04/%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%B7%A5%E5%85%B7%E7%B1%BB/">读取配置文件工具类</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.haier.otcwms.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sysconfig</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Properties sysConfig = <span class="keyword">new</span> Properties();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">static</span> &#123; <span class="comment">// 读取配置文件</span></span><br><span class="line"></span><br><span class="line">		InputStream inputStream = Sysconfig.class</span><br><span class="line"></span><br><span class="line">		.getResourceAsStream(<span class="string">&quot;/infterfaceAddr.properties&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">			sysConfig.load(inputStream);</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line"></span><br><span class="line">			e.printStackTrace();</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">				inputStream.close();</span><br><span class="line"></span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line"></span><br><span class="line">				e.printStackTrace();</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 根据属性读取配置文件</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getProperty</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> sysConfig.getProperty(key);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 根据属性写入配置文件</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setProperty</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		sysConfig.setProperty(key, value);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/04/%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%B7%A5%E5%85%B7%E7%B1%BB/" data-id="ckke5nr460044cl8g0hq83ilg" data-title="读取配置文件工具类" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tool/" rel="tag">tool</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-过滤器和拦截器" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/04/%E8%BF%87%E6%BB%A4%E5%99%A8%E5%92%8C%E6%8B%A6%E6%88%AA%E5%99%A8/" class="article-date">
  <time class="dt-published" datetime="2020-12-04T02:10:17.000Z" itemprop="datePublished">2020-12-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/04/%E8%BF%87%E6%BB%A4%E5%99%A8%E5%92%8C%E6%8B%A6%E6%88%AA%E5%99%A8/">过滤器和拦截器</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1、过滤器（Filter）"><a href="#1、过滤器（Filter）" class="headerlink" title="1、过滤器（Filter）"></a>1、过滤器（Filter）</h2><p>首先说一下Filter的使用地方，我们在<strong>配置web.xml</strong>时，总会配置下面一段设置字符编码，不然会导致乱码问题：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置字符编码过滤器:解决乱码问题--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>配置这个地方的目的，是让所有的请求都需要进行字符编码的设置，下面来介绍一下Filter。</p>
<p><strong>过滤器(Filter)**：它</strong>依赖于servlet容器<strong>。在</strong>实现上，基于函数回调<strong>，它可以对几乎所有请求进行过滤，但是</strong>缺点是一个过滤器实例只能在容器初始化时调用一次<strong>。使用过滤器的</strong>目的，是用来做一些过滤操作<strong>，获取我们想要获取的数据，比如：在Javaweb中，对传入的request、response提前过滤掉一些信息，或者提前设置一些参数，然后再传入servlet或者Controller进行业务逻辑操作。</strong>常用的场景是：在过滤器中修改字符编码<strong>（CharacterEncodingFilter）、在过滤器中修改HttpServletRequest的一些参数（XSSFilter(自定义过滤器)），如：</strong>过滤低俗文字、危险字符等**。</p>
<h2 id="2、拦截器（Interceptor）"><a href="#2、拦截器（Interceptor）" class="headerlink" title="2、拦截器（Interceptor）"></a>2、拦截器（Interceptor）</h2><p>拦截器的配置一般在<strong>SpringMVC的配置文件中</strong>，使用Interceptors标签，具体配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/**&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.scorpios.atcrowdfunding.web.LoginInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/**&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.scorpios.atcrowdfunding.web.AuthInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p><strong>拦截器（Interceptor）</strong>：它<strong>依赖于web框架，在SpringMVC中就是依赖于SpringMVC框架</strong>。在<strong>实现上基于Java的反射机制，属于面向切面编程（AOP）的一种运用</strong>，就是在service或者一个方法前，调用一个方法，或者在方法后，调用一个方法，比如动态代理就是拦截器的简单实现，在调用方法前打印出字符串（或者做其它业务逻辑的操作），也可以在调用方法后打印出字符串，甚至在抛出异常的时候做业务逻辑的操作。由于拦截器是基于web框架的调用，因此可以使用Spring的依赖注入（DI）进行一些业务操作，同时<strong>一个拦截器实例在一个controller生命周期之内可以多次调用</strong>。但是缺点是只能对controller请求进行拦截，对其他的一些比如直接访问静态资源的请求则没办法进行拦截处理。</p>
<blockquote>
<p><strong>静态资源例如html这些放在webinf目录下 不通过拦截器是访问不了的,</strong></p>
<p><strong>开发时需要在web.xml文件中设置default sevlet-mapping将静态资源排除掉</strong></p>
</blockquote>
<h2 id="3、代码"><a href="#3、代码" class="headerlink" title="3、代码"></a>3、代码</h2><p>下面在一个项目中我们使用既有多个过滤器，又有多个拦截器，并观察它们的执行顺序：<br><strong>（1）第一个过滤器：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestFilter1</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;  </span><br><span class="line">   </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;  </span><br><span class="line">         </span><br><span class="line">        <span class="comment">//在DispatcherServlet之前执行  </span></span><br><span class="line">System.out.println(<span class="string">&quot;############TestFilter1 doFilterInternal executed############&quot;</span>);  </span><br><span class="line">        filterChain.doFilter(request, response);  </span><br><span class="line">        <span class="comment">//在视图页面返回给客户端之前执行，但是执行顺序在Interceptor之后  </span></span><br><span class="line">        System.out.println(<span class="string">&quot;############TestFilter1 doFilter after############&quot;</span>);  </span><br><span class="line">    </span><br><span class="line">       HttpServletRequest request = (HttpServletRequest) req;</span><br><span class="line">    HttpServletResponse response = (HttpServletResponse) rep;</span><br><span class="line">    HttpSession session = request.getSession();</span><br><span class="line">     </span><br><span class="line">    ServletContext application = session.getServletContext();</span><br><span class="line">    <span class="keyword">if</span> (session.getAttribute(<span class="string">&quot;userSession&quot;</span>)==<span class="keyword">null</span>)&#123;<span class="comment">//</span></span><br><span class="line">        response.sendRedirect(<span class="string">&quot;/views/index.jsp&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//放行</span></span><br><span class="line">        chain.doFilter(req,rep);</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（2）第二个过滤器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestFilter2</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;  </span><br><span class="line">    <span class="comment">//在DispatcherServlet之前执行  </span></span><br><span class="line">        System.out.println(<span class="string">&quot;############TestFilter2 doFilterInternal executed############&quot;</span>);  </span><br><span class="line">        filterChain.doFilter(request, response);  </span><br><span class="line">        <span class="comment">//在视图页面返回给客户端之前执行，但是执行顺序在Interceptor之后 </span></span><br><span class="line">        System.out.println(<span class="string">&quot;############TestFilter2 doFilter after############&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>（3）在web.xml中注册这两个过滤器：</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 自定义过滤器：testFilter1 --&gt;</span>   </span><br><span class="line">   <span class="tag">&lt;<span class="name">filter</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>testFilter1<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.scorpios.filter.TestFilter1<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>testFilter1<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- 自定义过滤器：testFilter2 --&gt;</span>   </span><br><span class="line">   <span class="tag">&lt;<span class="name">filter</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>testFilter2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.scorpios.filter.TestFilter2<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>testFilter2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>再定义两个拦截器：</p>
<p>（4）第一个拦截器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span></span>&#123;  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 在DispatcherServlet之前执行 </span></span><br><span class="line"><span class="comment">     * */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest arg0, HttpServletResponse arg1, Object arg2)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;************BaseInterceptor preHandle executed**********&quot;</span>);  </span><br><span class="line">        System.out.println(<span class="string">&quot;MyInterceptor:&quot;</span>+request.getContextPath()+<span class="string">&quot;,&quot;</span>+request.getRequestURI()+<span class="string">&quot;,&quot;</span>+request.getMethod());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 在controller执行之后的DispatcherServlet之后执行 </span></span><br><span class="line"><span class="comment">     * */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest arg0, HttpServletResponse arg1, Object arg2, ModelAndView arg3)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;************BaseInterceptor postHandle executed**********&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 在页面渲染完成返回给客户端之前执行 </span></span><br><span class="line"><span class="comment">     * */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest arg0, HttpServletResponse arg1, Object arg2, Exception arg3)</span>  </span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;************BaseInterceptor afterCompletion executed**********&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（5）第二个拦截器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest arg0, HttpServletResponse arg1, Object arg2)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;************TestInterceptor preHandle executed**********&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest arg0, HttpServletResponse arg1, Object arg2, ModelAndView arg3)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;************TestInterceptor postHandle executed**********&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest arg0, HttpServletResponse arg1, Object arg2, Exception arg3)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;************TestInterceptor afterCompletion executed**********&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（6）、在SpringMVC的配置文件中，加上拦截器的配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 拦截器 --&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span>  </span><br><span class="line">    <span class="comment">&lt;!-- 对所有请求都拦截，公共拦截器可以有多个 --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;baseInterceptor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.scorpios.interceptor.BaseInterceptor&quot;</span> /&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span> </span><br><span class="line">    		<span class="comment">&lt;!-- 对/test.html进行拦截 --&gt;</span>       </span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/test.html&quot;</span>/&gt;</span>  </span><br><span class="line">        <span class="comment">&lt;!-- 特定请求的拦截器只能有一个 --&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.scorpios.interceptor.TestInterceptor&quot;</span> /&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p>（7）、定义一个Controller控制器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.scorpios.controller;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;  </span><br><span class="line">   </span><br><span class="line"><span class="meta">@Controller</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;  </span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/test&quot;)</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">handleRequest</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;---------TestController executed--------&quot;</span>);  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">&quot;test&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>（8）、测试结果：</strong><br>启动测试项目，地址如下：<a target="_blank" rel="noopener" href="http://www.localhost:8080/demo">http://www.localhost:8080/demo， 可以看到控制台中输出如下：</a></p>
<p><img src="http://59.110.212.214/upload/20200710_15252595.png"></p>
<p>这就说明了过滤器的运行是依赖于servlet容器，跟springmvc等框架并没有关系。并且，<strong>多个过滤器的执行顺序跟xml文件中定义的先后关系有关。</strong></p>
<p>接着清空控制台，并访问：</p>
<p><a target="_blank" rel="noopener" href="http://www.localhost:8080/demo/test%EF%BC%8C%E5%86%8D%E6%AC%A1%E7%9C%8B%E6%8E%A7%E5%88%B6%E5%8F%B0%E7%9A%84%E8%BE%93%E5%87%BA%EF%BC%9A">http://www.localhost:8080/demo/test，再次看控制台的输出：</a></p>
<p><img src="http://59.110.212.214/upload/20200710_15250263.png"></p>
<p>从这个控制台打印输出，就可以很清晰地看到有多个拦截器和过滤器存在时的整个执行顺序了。当然，对于<strong>多个拦截器它们之间的执行顺序跟在SpringMVC的配置文件中定义的先后顺序有关。</strong></p>
<h2 id="4、总结"><a href="#4、总结" class="headerlink" title="4、总结"></a>4、总结</h2><p>对于上述过滤器和拦截器的测试，可以得到如下结论：</p>
<ul>
<li><p>Filter需要在web.xml中配置，依赖于Servlet；</p>
</li>
<li><p>Interceptor需要在SpringMVC中配置，依赖于框架；</p>
</li>
<li><p>Filter的执行顺序在Interceptor之前，具体的流程见下图；</p>
<p><img src="http://59.110.212.214/upload/20200710_15244169.png"></p>
</li>
<li><p>两者的本质区别：拦截器（Interceptor）是基于Java的反射机制，而过滤器（Filter）是基于函数回调。从灵活性上说拦截器功能更强大些，Filter能做的事情，都能做，而且可以在请求前，请求后执行，比较灵活。Filter主要是针对URL地址做一个编码的事情、过滤掉没用的参数、安全校验（比较泛的，比如登录不登录之类），太细的话，还是建议用interceptor。不过还是根据不同情况选择合适的。</p>
</li>
</ul>
<p>————————————————</p>
<p>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/zxd1435513775/article/details/80556034">https://blog.csdn.net/zxd1435513775/article/details/80556034</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/04/%E8%BF%87%E6%BB%A4%E5%99%A8%E5%92%8C%E6%8B%A6%E6%88%AA%E5%99%A8/" data-id="ckke5nr470047cl8g2hnj1gvm" data-title="过滤器和拦截器" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/filter/" rel="tag">filter</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/interceptor/" rel="tag">interceptor</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java%E5%9F%BA%E7%A1%80/" rel="tag">java基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%8B%A6%E6%88%AA%E5%99%A8/" rel="tag">拦截器</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BF%87%E6%BB%A4%E5%99%A8/" rel="tag">过滤器</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Spring Boot中使用缓存" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/04/Spring%20Boot%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98/" class="article-date">
  <time class="dt-published" datetime="2020-12-04T02:10:17.000Z" itemprop="datePublished">2020-12-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/springboot/">springboot</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/04/Spring%20Boot%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98/">Spring Boot中使用缓存</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在程序中可以使用缓存的技术来节省对数据库的开销。Spring Boot对缓存提供了很好的支持，我们几乎不用做过多的配置即可使用各种缓存实现。这里主要介绍平日里个人接触较多的Ehcache和Redis缓存实现。</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>yml中配置日志输出级别以观察SQL的执行情况：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com:</span></span><br><span class="line">      <span class="attr">springboot:</span></span><br><span class="line">        <span class="attr">mapper:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure>


<p>其中<code>com.spring.mapper</code>为MyBatis的Mapper接口路径。</p>
<p>然后编写如下测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = Application.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StudentService studentService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Student student1 = <span class="keyword">this</span>.studentService.queryStudentBySno(<span class="string">&quot;001&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;学号&quot;</span> + student1.getSno() + <span class="string">&quot;的学生姓名为：&quot;</span> + student1.getName());</span><br><span class="line">        </span><br><span class="line">        Student student2 = <span class="keyword">this</span>.studentService.queryStudentBySno(<span class="string">&quot;001&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;学号&quot;</span> + student2.getSno() + <span class="string">&quot;的学生姓名为：&quot;</span> + student2.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>右键run as junit test：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">2017-11-17 16:34:26.535 DEBUG 9932 --- [main] c.s.m.StudentMapper.queryStudentBySno    : ==&gt;  Preparing: select * from student where sno=? </span><br><span class="line">2017-11-17 16:34:26.688 DEBUG 9932 --- [main] c.s.m.StudentMapper.queryStudentBySno    : ==&gt; Parameters: 001(String)</span><br><span class="line">2017-11-17 16:34:26.716 DEBUG 9932 --- [main] c.s.m.StudentMapper.queryStudentBySno    : &lt;==      Total: 1</span><br><span class="line">学号001的学生姓名为：KangKang</span><br><span class="line">2017-11-17 16:34:26.720 DEBUG 9932 --- [main] c.s.m.StudentMapper.queryStudentBySno    : ==&gt;  Preparing: select * from student where sno=? </span><br><span class="line">2017-11-17 16:34:26.720 DEBUG 9932 --- [main] c.s.m.StudentMapper.queryStudentBySno    : ==&gt; Parameters: 001(String)</span><br><span class="line">2017-11-17 16:34:26.721 DEBUG 9932 --- [main] c.s.m.StudentMapper.queryStudentBySno    : &lt;==      Total: 1</span><br><span class="line">学号001的学生姓名为：KangKang</span><br></pre></td></tr></table></figure>


<p>可发现第二个查询虽然和第一个查询完全一样，但其还是对数据库进行了查询。接下来引入缓存来改善这个结果。</p>
<h2 id="使用缓存"><a href="#使用缓存" class="headerlink" title="使用缓存"></a>使用缓存</h2><p>要开启Spring Boot的缓存功能，需要在pom中引入<code>spring-boot-starter-cache</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p>接着在Spring Boot入口类中加入<code>@EnableCaching</code>注解开启缓存功能：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Application.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>在StudentService接口中加入缓存注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CacheConfig(cacheNames = &quot;student&quot;)</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@CachePut(key = &quot;#p0.sno&quot;)</span></span><br><span class="line">    <span class="function">Student <span class="title">update</span><span class="params">(Student student)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@CacheEvict(key = &quot;#p0&quot;, allEntries = true)</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteStudentBySno</span><span class="params">(String sno)</span></span>;</span><br><span class="line">    </span><br><span class="line">  	<span class="comment">//将id作为redis中的key值</span></span><br><span class="line">    <span class="meta">@Cacheable(key = &quot;#p0&quot;)</span></span><br><span class="line">    <span class="function">Student <span class="title">queryStudentBySno</span><span class="params">(String sno)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>我们在StudentService接口中加入了<code>@CacheConfig</code>注解，queryStudentBySno方法使用了注解<code>@Cacheable(key=&quot;#p0&quot;)</code>，即将id作为redis中的key值。当我们更新数据的时候，应该使用<code>@CachePut(key=&quot;#p0.sno&quot;)</code>进行缓存数据的更新，否则将查询到脏数据，因为该注解保存的是方法的返回值，所以这里应该返回Student。</p>
<p>其实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository(&quot;studentService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentServiceImpl</span> <span class="keyword">implements</span> <span class="title">StudentService</span></span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StudentMapper studentMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Student <span class="title">update</span><span class="params">(Student student)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.studentMapper.update(student);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.studentMapper.queryStudentBySno(student.getSno());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteStudentBySno</span><span class="params">(String sno)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.studentMapper.deleteStudentBySno(sno);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Student <span class="title">queryStudentBySno</span><span class="params">(String sno)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.studentMapper.queryStudentBySno(sno);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>在Spring Boot中可使用的缓存注解有：</p>
<h3 id="缓存注解"><a href="#缓存注解" class="headerlink" title="缓存注解"></a>缓存注解</h3><ol>
<li><code>@CacheConfig</code>：主要用于配置该类中会用到的一些共用的缓存配置。在这里<code>@CacheConfig(cacheNames = &quot;student&quot;)</code>：配置了该数据访问对象中返回的内容将存储于名为student的缓存对象中，我们也可以不使用该注解，直接通过<code>@Cacheable</code>自己配置缓存集的名字来定义；</li>
<li><code>@Cacheable</code>：配置了queryStudentBySno函数的返回值将被加入缓存。同时在查询时，会先从缓存中获取，若不存在才再发起对数据库的访问。该注解主要有下面几个参数：<ul>
<li><code>value</code>、<code>cacheNames</code>：两个等同的参数（cacheNames为Spring 4新增，作为value的别名），用于指定缓存存储的集合名。由于Spring 4中新增了<code>@CacheConfig</code>，因此在Spring 3中原本必须有的value属性，也成为非必需项了；</li>
<li><code>key</code>：缓存对象存储在Map集合中的key值，非必需，缺省按照函数的所有参数组合作为key值，若自己配置需使用SpEL表达式，比如：<code>@Cacheable(key = &quot;#p0&quot;)</code>：使用函数第一个参数作为缓存的key值，更多关于SpEL表达式的详细内容可参考<a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#cache%EF%BC%9B">https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#cache；</a></li>
<li><code>condition</code>：缓存对象的条件，非必需，也需使用SpEL表达式，只有满足表达式条件的内容才会被缓存，比如：<code>@Cacheable(key = &quot;#p0&quot;, condition = &quot;#p0.length() &lt; 3&quot;)</code>，表示只有当第一个参数的长度小于3的时候才会被缓存；</li>
<li><code>unless</code>：另外一个缓存条件参数，非必需，需使用SpEL表达式。它不同于condition参数的地方在于它的判断时机，该条件是在函数被调用之后才做判断的，所以它可以通过对result进行判断；</li>
<li><code>keyGenerator</code>：用于指定key生成器，非必需。若需要指定一个自定义的key生成器，我们需要去实现<code>org.springframework.cache.interceptor.KeyGenerator</code>接口，并使用该参数来指定；</li>
<li><code>cacheManager</code>：用于指定使用哪个缓存管理器，非必需。只有当有多个时才需要使用；</li>
<li><code>cacheResolver</code>：用于指定使用那个缓存解析器，非必需。需通过org.springframework.cache.interceptor.CacheResolver接口来实现自己的缓存解析器，并用该参数指定；</li>
</ul>
</li>
<li><code>@CachePut</code>：配置于函数上，能够根据参数定义条件来进行缓存，其缓存的是方法的返回值，它与<code>@Cacheable</code>不同的是，它每次都会真实调用函数，所以主要用于数据新增和修改操作上。它的参数与<code>@Cacheable</code>类似，具体功能可参考上面对<code>@Cacheable</code>参数的解析；</li>
<li><code>@CacheEvict</code>：配置于函数上，通常用在删除方法上，用来从缓存中移除相应数据。除了同<code>@Cacheable</code>一样的参数之外，它还有下面两个参数：<ul>
<li><code>allEntries</code>：非必需，默认为false。当为true时，会移除所有数据；</li>
<li><code>beforeInvocation</code>：非必需，默认为false，会在调用方法之后移除数据。当为true时，会在调用方法之前移除数据。</li>
</ul>
</li>
</ol>
<h3 id="缓存实现"><a href="#缓存实现" class="headerlink" title="缓存实现"></a>缓存实现</h3><p>要使用上Spring Boot的缓存功能，还需要提供一个缓存的具体实现。Spring Boot根据下面的顺序去侦测缓存实现：</p>
<ul>
<li>Generic</li>
<li>JCache (JSR-107)</li>
<li>EhCache 2.x</li>
<li>Hazelcast</li>
<li>Infinispan</li>
<li>Redis</li>
<li>Guava</li>
<li>Simple</li>
</ul>
<p>除了按顺序侦测外，我们也可以通过配置属性spring.cache.type来强制指定。</p>
<p>接下来主要介绍基于Redis和Ehcache的缓存实现。</p>
<h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><p>Redis的下载地址为<a target="_blank" rel="noopener" href="https://github.com/MicrosoftArchive/redis/releases%EF%BC%8CRedis">https://github.com/MicrosoftArchive/redis/releases，Redis</a> 支持 32 位和 64 位。这个需要根据你系统平台的实际情况选择，这里我们下载 Redis-x64-xxx.zip压缩包到C盘。打开一个CMD窗口，输入如下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;cd c:\Redis-x64-3.2.100</span><br><span class="line"></span><br><span class="line">c:\Redis-x64-3.2.100&gt;redis-server.exe redis.windows.conf</span><br><span class="line">                _._</span><br><span class="line">           _.-``__ &#x27;&#x27;-._</span><br><span class="line">      _.-``    `.  `_.  &#x27;&#x27;-._           Redis 3.2.100 (00000000/0) 64 bit</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ &#x27;&#x27;-._</span><br><span class="line"> (    &#x27;      ,       .-`  | `,    )     Running in standalone mode</span><br><span class="line"> |`-._`-...-` __...-.``-._|&#x27;` _.-&#x27;|     Port: 6379</span><br><span class="line"> |    `-._   `._    /     _.-&#x27;    |     PID: 6404</span><br><span class="line">  `-._    `-._  `-./  _.-&#x27;    _.-&#x27;</span><br><span class="line"> |`-._`-._    `-.__.-&#x27;    _.-&#x27;_.-&#x27;|</span><br><span class="line"> |    `-._`-._        _.-&#x27;_.-&#x27;    |           http://redis.io</span><br><span class="line">  `-._    `-._`-.__.-&#x27;_.-&#x27;    _.-&#x27;</span><br><span class="line"> |`-._`-._    `-.__.-&#x27;    _.-&#x27;_.-&#x27;|</span><br><span class="line"> |    `-._`-._        _.-&#x27;_.-&#x27;    |</span><br><span class="line">  `-._    `-._`-.__.-&#x27;_.-&#x27;    _.-&#x27;</span><br><span class="line">      `-._    `-.__.-&#x27;    _.-&#x27;</span><br><span class="line">          `-._        _.-&#x27;</span><br><span class="line">              `-.__.-&#x27;</span><br><span class="line"></span><br><span class="line">[6404] 25 Dec 09:47:58.890 # Server started, Redis version 3.2.100</span><br><span class="line">[6404] 25 Dec 09:47:58.898 * DB loaded from disk: 0.007 seconds</span><br><span class="line">[6404] 25 Dec 09:47:58.898 * The server is now ready to accept connections on port 6379</span><br></pre></td></tr></table></figure>


<p>然后打开另外一个CMD终端，输入：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;cd c:\Redis-x64-3.2.100</span><br><span class="line"></span><br><span class="line">c:\Redis-x64-3.2.100&gt;redis-cli.exe -p 6379</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>


<p>准备工作做完后，接下来开始在Spring Boot项目里引入Redis：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring-boot redis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p>在application.yml中配置Redis：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="comment"># Redis数据库索引（默认为0）</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="comment"># Redis服务器地址</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="comment"># Redis服务器连接端口</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">pool:</span></span><br><span class="line">      <span class="comment"># 连接池最大连接数（使用负值表示没有限制）</span></span><br><span class="line">      <span class="attr">max-active:</span> <span class="number">8</span></span><br><span class="line">      <span class="comment"># 连接池最大阻塞等待时间（使用负值表示没有限制）</span></span><br><span class="line">      <span class="attr">max-wait:</span> <span class="number">-1</span></span><br><span class="line">      <span class="comment"># 连接池中的最大空闲连接</span></span><br><span class="line">      <span class="attr">max-idle:</span> <span class="number">8</span></span><br><span class="line">      <span class="comment"># 连接池中的最小空闲连接</span></span><br><span class="line">      <span class="attr">min-idle:</span> <span class="number">0</span></span><br><span class="line">    <span class="comment"># 连接超时时间（毫秒）</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>


<p>更多关于Spring Boot Redis配置可参考：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/common-application-properties.html#">https://docs.spring.io/spring-boot/docs/current/reference/html/common-application-properties.html#</a> REDIS</p>
<p>接着创建一个Redis配置类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> <span class="keyword">extends</span> <span class="title">CachingConfigurerSupport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自定义缓存key生成策略</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> KeyGenerator <span class="title">keyGenerator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> KeyGenerator() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">generate</span><span class="params">(Object target, java.lang.reflect.Method method, Object... params)</span> </span>&#123;</span><br><span class="line">                StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">                sb.append(target.getClass().getName());</span><br><span class="line">                sb.append(method.getName());</span><br><span class="line">                <span class="keyword">for</span> (Object obj : params) &#123;</span><br><span class="line">                    sb.append(obj.toString());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> sb.toString();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 缓存管理器</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CacheManager <span class="title">cacheManager</span><span class="params">(<span class="meta">@SuppressWarnings(&quot;rawtypes&quot;)</span> RedisTemplate redisTemplate)</span> </span>&#123;</span><br><span class="line">        RedisCacheManager cacheManager = <span class="keyword">new</span> RedisCacheManager(redisTemplate);</span><br><span class="line">        <span class="comment">// 设置缓存过期时间（秒）</span></span><br><span class="line">        cacheManager.setDefaultExpiration(<span class="number">3600</span>);</span><br><span class="line">        <span class="keyword">return</span> cacheManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, String&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory factory)</span> </span>&#123;</span><br><span class="line">        StringRedisTemplate template = <span class="keyword">new</span> StringRedisTemplate(factory);</span><br><span class="line">        setSerializer(template);<span class="comment">// 设置序列化工具</span></span><br><span class="line">        template.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setSerializer</span><span class="params">(StringRedisTemplate template)</span> </span>&#123;</span><br><span class="line">        <span class="meta">@SuppressWarnings(&#123; &quot;rawtypes&quot;, &quot;unchecked&quot; &#125;)</span></span><br><span class="line">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer(Object.class);</span><br><span class="line">        ObjectMapper om = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>运行测试，控制台输出：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2017-11-17 18:17:06.995 DEBUG 8836 --- [main] c.s.m.StudentMapper.queryStudentBySno    : ==&gt;  Preparing: select * from student where sno=? </span><br><span class="line">2017-11-17 18:17:07.128 DEBUG 8836 --- [main] c.s.m.StudentMapper.queryStudentBySno    : ==&gt; Parameters: 001(String)</span><br><span class="line">2017-11-17 18:17:07.152 DEBUG 8836 --- [main] c.s.m.StudentMapper.queryStudentBySno    : &lt;==      Total: 1</span><br><span class="line">学号001的学生姓名为：KangKang</span><br><span class="line">学号001的学生姓名为：KangKang</span><br></pre></td></tr></table></figure>


<p>第二次查询没有访问数据库，而是从缓存中获取的，在redis中查看该值：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;   keys *</span><br><span class="line">1) &quot;student~keys&quot;</span><br><span class="line">2) &quot;001&quot;</span><br><span class="line">127.0.0.1:6379&gt; get 001</span><br><span class="line">&quot;[\&quot;com.springboot.bean.Student\&quot;,&#123;\&quot;sno\&quot;:\&quot;001\&quot;,\&quot;name\&quot;:\&quot;KangKang\&quot;,\&quot;sex\&quot;:\&quot;M \&quot;&#125;]&quot;</span><br></pre></td></tr></table></figure>


<p>在测试方法中测试更新：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Student student1 = <span class="keyword">this</span>.studentService.queryStudentBySno(<span class="string">&quot;001&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;学号&quot;</span> + student1.getSno() + <span class="string">&quot;的学生姓名为：&quot;</span> + student1.getName());</span><br><span class="line">    </span><br><span class="line">    student1.setName(<span class="string">&quot;康康&quot;</span>);</span><br><span class="line">    <span class="keyword">this</span>.studentService.update(student1);</span><br><span class="line">    </span><br><span class="line">    Student student2 = <span class="keyword">this</span>.studentService.queryStudentBySno(<span class="string">&quot;001&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;学号&quot;</span> + student2.getSno() + <span class="string">&quot;的学生姓名为：&quot;</span> + student2.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>控制台输出：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">学号001的学生姓名为：KangKang</span><br><span class="line">2017-11-17 19:30:05.813  INFO 11244 --- [main] com.alibaba.druid.pool.DruidDataSource   : &#123;dataSource-1&#125; inited</span><br><span class="line">2017-11-17 19:30:05.823 DEBUG 11244 --- [main] c.s.mapper.StudentMapper.update          : ==&gt;  Preparing: update student set sname=?,ssex=? where sno=? </span><br><span class="line">2017-11-17 19:30:05.941 DEBUG 11244 --- [main] c.s.mapper.StudentMapper.update          : ==&gt; Parameters: 康康(String), M (String), 001(String)</span><br><span class="line">2017-11-17 19:30:05.953 DEBUG 11244 --- [main] c.s.mapper.StudentMapper.update          : &lt;==    Updates: 1</span><br><span class="line">2017-11-17 19:30:05.957 DEBUG 11244 --- [main] c.s.m.StudentMapper.queryStudentBySno    : ==&gt;  Preparing: select * from student where sno=? </span><br><span class="line">2017-11-17 19:30:05.959 DEBUG 11244 --- [main] c.s.m.StudentMapper.queryStudentBySno    : ==&gt; Parameters: 001(String)</span><br><span class="line">2017-11-17 19:30:05.976 DEBUG 11244 --- [main] c.s.m.StudentMapper.queryStudentBySno    : &lt;==      Total: 1</span><br><span class="line">学号001的学生姓名为：康康</span><br></pre></td></tr></table></figure>


<p>在redis中查看：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get 001</span><br><span class="line">&quot;[\&quot;com.springboot.bean.Student\&quot;,&#123;\&quot;sno\&quot;:\&quot;001\&quot;,\&quot;name\&quot;:\&quot;\xe5\xba\xb7\xe5\xba\xb7\&quot;,\&quot;sex\&quot;:\&quot;M \&quot;&#125;]&quot;</span><br></pre></td></tr></table></figure>


<p>可见更新数据库的同时，缓存也得到了更新。</p>
<p>源码链接：<a target="_blank" rel="noopener" href="https://github.com/wuyouzhuguli/Spring-Boot-Demos/tree/master/09.Spring-Boot-Redis-Cache">https://github.com/wuyouzhuguli/Spring-Boot-Demos/tree/master/09.Spring-Boot-Redis-Cache</a></p>
<h3 id="Ehcache"><a href="#Ehcache" class="headerlink" title="Ehcache"></a>Ehcache</h3><p>引入Ehcache依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ehcache --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sf.ehcache<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p>在src/main/resources目录下新建ehcache.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">&quot;ehcache.xsd&quot;</span>&gt;</span></span><br><span class="line">    &lt;defaultCache</span><br><span class="line">        maxElementsInMemory=&quot;10000&quot;</span><br><span class="line">        eternal=&quot;false&quot;</span><br><span class="line">        timeToIdleSeconds=&quot;3600&quot;</span><br><span class="line">        timeToLiveSeconds=&quot;0&quot;</span><br><span class="line">        overflowToDisk=&quot;false&quot;</span><br><span class="line">        diskPersistent=&quot;false&quot;</span><br><span class="line">        diskExpiryThreadIntervalSeconds=&quot;120&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">&quot;student&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">maxEntriesLocalHeap</span>=<span class="string">&quot;2000&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">eternal</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">timeToIdleSeconds</span>=<span class="string">&quot;3600&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">timeToLiveSeconds</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">overflowToDisk</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">statistics</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p>关于Ehcahe的一些说明：</p>
<ul>
<li>name：缓存名称。</li>
<li>maxElementsInMemory：缓存最大数目</li>
<li>maxElementsOnDisk：硬盘最大缓存个数。</li>
<li>eternal：对象是否永久有效，一但设置了，timeout将不起作用。</li>
<li>overflowToDisk：是否保存到磁盘。</li>
<li>timeToIdleSeconds:设置对象在失效前的允许闲置时间（单位：秒）。仅当<code>eternal=false</code>对象不是永久有效时使用，可选属性，默认值是0，也就是可闲置时间无穷大。</li>
<li>timeToLiveSeconds：设置对象在失效前允许存活时间（单位：秒）。最大时间介于创建时间和失效时间之间。仅当<code>eternal=false</code>对象不是永久有效时使用，默认是0，也就是对象存活时间无穷大。</li>
<li>diskPersistent：是否缓存虚拟机重启期数据，默认值为false。</li>
<li>diskSpoolBufferSizeMB：这个参数设置DiskStore（磁盘缓存）的缓存区大小。默认是30MB。每个Cache都应该有自己的一个缓冲区。</li>
<li>diskExpiryThreadIntervalSeconds：磁盘失效线程运行时间间隔，默认是120秒。</li>
<li>memoryStoreEvictionPolicy：当达到maxElementsInMemory限制时，Ehcache将会根据指定的策略去清理内存。默认策略是LRU（最近最少使用）。你可以设置为FIFO（先进先出）或是LFU（较少使用）。</li>
<li>clearOnFlush：内存数量最大时是否清除。</li>
<li>memoryStoreEvictionPolicy：Ehcache的三种清空策略：<strong>FIFO</strong>，first in first out，这个是大家最熟的，先进先出。<strong>LFU</strong>， Less Frequently Used，就是上面例子中使用的策略，直白一点就是讲一直以来最少被使用的。如上面所讲，缓存的元素有一个hit属性，hit值最小的将会被清出缓存。<strong>LRU</strong>，Least Recently Used，最近最少使用的，缓存的元素有一个时间戳，当缓存容量满了，而又需要腾出地方来缓存新的元素的时候，那么现有缓存元素中时间戳离当前时间最远的元素将被清出缓存。</li>
</ul>
<p>接着在application.yml中指定ehcache配置的路径：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cache:</span></span><br><span class="line">    <span class="attr">ehcache:</span></span><br><span class="line">      <span class="attr">config:</span> <span class="string">&#x27;classpath:ehcache.xml&#x27;</span></span><br></pre></td></tr></table></figure>


<p>这样就可以开始使用ehcache了，运行测试类，观察控制台：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2017-11-18 09:10:40.201 DEBUG 3364 --- [main] c.s.m.StudentMapper.queryStudentBySno    : ==&gt;  Preparing: select * from student where sno=? </span><br><span class="line">2017-11-18 09:10:40.343 DEBUG 3364 --- [main] c.s.m.StudentMapper.queryStudentBySno    : ==&gt; Parameters: 001(String)</span><br><span class="line">2017-11-18 09:10:40.364 DEBUG 3364 --- [main] c.s.m.StudentMapper.queryStudentBySno    : &lt;==      Total: 1</span><br><span class="line">学号001的学生姓名为：KangKang</span><br><span class="line">学号001的学生姓名为：KangKang</span><br></pre></td></tr></table></figure>


<p>可看到第二次是从缓存中获取的。</p>
<p>测试更新：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">2017-11-18 09:18:04.230 DEBUG 11556 --- [main] c.s.m.StudentMapper.queryStudentBySno    : ==&gt;  Preparing: select * from student where sno=? </span><br><span class="line">2017-11-18 09:18:04.397 DEBUG 11556 --- [main] c.s.m.StudentMapper.queryStudentBySno    : ==&gt; Parameters: 001(String)</span><br><span class="line">2017-11-18 09:18:04.427 DEBUG 11556 --- [main] c.s.m.StudentMapper.queryStudentBySno    : &lt;==      Total: 1</span><br><span class="line">学号001的学生姓名为：KangKang</span><br><span class="line">2017-11-18 09:18:04.433 DEBUG 11556 --- [main] c.s.mapper.StudentMapper.update          : ==&gt;  Preparing: update student set sname=?,ssex=? where sno=? </span><br><span class="line">2017-11-18 09:18:04.438 DEBUG 11556 --- [main] c.s.mapper.StudentMapper.update          : ==&gt; Parameters: 康康(String), M (String), 001(String)</span><br><span class="line">2017-11-18 09:18:04.440 DEBUG 11556 --- [main] c.s.mapper.StudentMapper.update          : &lt;==    Updates: 1</span><br><span class="line">2017-11-18 09:18:04.440 DEBUG 11556 --- [main] c.s.m.StudentMapper.queryStudentBySno    : ==&gt;  Preparing: select * from student where sno=? </span><br><span class="line">2017-11-18 09:18:04.441 DEBUG 11556 --- [main] c.s.m.StudentMapper.queryStudentBySno    : ==&gt; Parameters: 001(String)</span><br><span class="line">2017-11-18 09:18:04.442 DEBUG 11556 --- [main] c.s.m.StudentMapper.queryStudentBySno    : &lt;==      Total: 1</span><br><span class="line">学号001的学生姓名为：康康</span><br></pre></td></tr></table></figure>


<p>可见，即使更新方法加了<code>@CachePut</code>注解，第二次查询因为Student对象更新了，其是从数据库获取数据的，所以对于Ehcache来说，更新方法加不加<code>@CachePut</code>注解，结果都一样。</p>
<p>源码链接：<a target="_blank" rel="noopener" href="https://github.com/wuyouzhuguli/Spring-Boot-Demos/tree/master/10.Spring-Boot-Ehcache-Cache">https://github.com/wuyouzhuguli/Spring-Boot-Demos/tree/master/10.Spring-Boot-Ehcache-Cache</a></p>
<p>From: [<a target="_blank" rel="noopener" href="https://mrbird.cc/Spring-Boot%20cache.html]">https://mrbird.cc/Spring-Boot%20cache.html]</a>(</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/04/Spring%20Boot%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98/" data-id="ckke5nr56009ecl8ga5auedtm" data-title="Spring Boot中使用缓存" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/springboot/" rel="tag">springboot</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BC%93%E5%AD%98/" rel="tag">缓存</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-rabbitmq入门使用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/04/rabbitmq%E5%85%A5%E9%97%A8%E4%BD%BF%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2020-12-04T02:10:17.000Z" itemprop="datePublished">2020-12-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/mq/">mq</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/04/rabbitmq%E5%85%A5%E9%97%A8%E4%BD%BF%E7%94%A8/">rabbitmq入门使用</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="1-消息队列概述"><a href="#1-消息队列概述" class="headerlink" title="1.消息队列概述"></a>1.消息队列概述</h1><p>MQ:Message Queue,消息队列是应用程序与应用程序之间的通信方法.</p>
<h2 id="1-1为什么使用MQ"><a href="#1-1为什么使用MQ" class="headerlink" title="1.1为什么使用MQ"></a>1.1为什么使用MQ</h2><p>在项目中,可将一些无需即时返回且耗时的操作提取出来,进行异步处理,而这种异步处理的方式大大的节省了服务器的请求响应时间,从而提高了系统的吞吐量。</p>
<h2 id="1-2-开发中消息队列通常有如下应用场景"><a href="#1-2-开发中消息队列通常有如下应用场景" class="headerlink" title="1.2 开发中消息队列通常有如下应用场景:"></a>1.2 开发中消息队列通常有如下应用场景:</h2><p>1、任务异步处理<br>将不需要同步处理的并且耗时长的操作由消息队列通知消息接收方进行异步处理。提高了应用程序的响应时间。<br>2、应用程序解耦合<br>MQ相当于一个中介,生产方通过MQ与消费方交互,它将应用程序进行解耦合。</p>
<p><strong>MQ是消息通信的模型;实现MQ的大致有两种主流方式: AMQP, JMS.</strong></p>
<blockquote>
<p>AMQP是一种协议,更准确的说是一种binary wirelevel protocol (链接协议) 。这是其和JMS的本质差别, AMQP不从API层进行限定,而是直接定义网络交换的数据格式。  </p>
<p>JMS即Java消息服务JavaMessage Service)应用程序接口,是一个<strong>java平台</strong>关于面向消息中间件(MOM)的API,用于在两个应用程序之间,或分布式系统中发送消息,进行异步通信。</p>
</blockquote>
<h2 id="1-3-AMQP与JMS区别"><a href="#1-3-AMQP与JMS区别" class="headerlink" title="1.3 AMQP与JMS区别"></a>1.3 AMQP与JMS区别</h2><ul>
<li>JMS是定义了统一的接口,来对消息操作进行统一; AMQP是通过规定协议来统一数据交互的格式JMS限定了必须使用ava语言; </li>
<li>AMQP只是协议,不规定实现方式,因此是跨语言的。</li>
<li>JMS规定了两种消息模式;而AMQP的消息模式更加丰富</li>
</ul>
<h1 id="2-mac安装rabbitmq"><a href="#2-mac安装rabbitmq" class="headerlink" title="2.mac安装rabbitmq"></a>2.mac安装rabbitmq</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR;</span><br><span class="line">1[安装rabbitmq] --&gt; 2[安装rabbitmq可视化监控插件]--&gt;3[配置环境变量]--&gt;4[后台启动rabbitmq]</span><br></pre></td></tr></table></figure>
<h2 id="2-1brew-install-rabbitmq"><a href="#2-1brew-install-rabbitmq" class="headerlink" title="2.1brew install rabbitmq"></a>2.1brew install rabbitmq</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">==&gt; Installing rabbitmq</span><br><span class="line">==&gt; Downloading https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.8.3/rabbitmq-server-generic-unix-3.8.3.tar.xz</span><br><span class="line">==&gt; Downloading from https://github-production-release-asset-2e65be.s3.amazonaws.com/924551/9b363b00-6236-11ea-964e-aebcb201484a?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIW</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################################################### 100.0%</span></span></span><br><span class="line">==&gt; /usr/bin/unzip -qq -j /usr/local/Cellar/rabbitmq/3.8.3/plugins/rabbitmq_management-3.8.3.ez rabbitmq_management-3.8.3/priv/www/cli/rabbitmqadmin</span><br><span class="line">==&gt; Caveats</span><br><span class="line">Management Plugin enabled by default at http://localhost:15672</span><br><span class="line"></span><br><span class="line">Bash completion has been installed to:</span><br><span class="line">  /usr/local/etc/bash_completion.d</span><br><span class="line"></span><br><span class="line">To have launchd start rabbitmq now and restart at login:</span><br><span class="line">  brew services start rabbitmq</span><br><span class="line">Or, if you don&#x27;t want/need a background service you can just run:</span><br><span class="line">  rabbitmq-server</span><br><span class="line">==&gt; Summary</span><br><span class="line">🍺  /usr/local/Cellar/rabbitmq/3.8.3: 281 files, 20.4MB, built in 1 minute 10 seconds</span><br></pre></td></tr></table></figure>
<h2 id="2-2安装rabbitmq可视化监控插件"><a href="#2-2安装rabbitmq可视化监控插件" class="headerlink" title="2.2安装rabbitmq可视化监控插件"></a>2.2安装rabbitmq可视化监控插件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">boguotong:~ boguotong$ cd /usr/local/Cellar/rabbitmq/3.8.3/</span><br><span class="line">boguotong:3.8.3 boguotong$ sudo sbin/rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure>
<h2 id="2-3配置环境变量"><a href="#2-3配置环境变量" class="headerlink" title="2.3配置环境变量"></a>2.3配置环境变量</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bash_profile</span><br><span class="line"> //加入以下两行</span><br><span class="line">export RABBIT_HOME=/usr/local/Cellar/rabbitmq/3.8.3/sbin/</span><br><span class="line">export PATH=$CXF3:$JAVA_HOME:$PATH:$SAPJCO:$JETTY_HOME:$PYTHON_HOME:$RABBIT_HOME</span><br><span class="line"> // 立即生效</span><br><span class="line"> source /etc/profile</span><br></pre></td></tr></table></figure>
<h2 id="2-4后台启动rabbitmq"><a href="#2-4后台启动rabbitmq" class="headerlink" title="2.4后台启动rabbitmq"></a>2.4后台启动rabbitmq</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 后台启动</span><br><span class="line">sudo rabbitmq-server -detached  </span><br><span class="line">// 查看状态</span><br><span class="line">rabbitmqctl status </span><br><span class="line">// 访问可视化监控插件的界面</span><br><span class="line">// 浏览器内输入 http://localhost:15672,默认的用户名密码都是guest,登录后可以在Admin那一列菜单内添加自己的用户</span><br><span class="line">rabbitmqctl stop 关闭</span><br></pre></td></tr></table></figure>
<h1 id="3-创建工程"><a href="#3-创建工程" class="headerlink" title="3.创建工程"></a>3.创建工程</h1><blockquote>
<p>入门工程:生产者发送消息到RabbitMQ的队列(simple-queue ) ;消费者可以从队列中获取消息。可以使用Rab<br>RabbitMQ的简单模式( simple )</p>
</blockquote>
<h2 id="3-1-引入依赖"><a href="#3-1-引入依赖" class="headerlink" title="3.1 引入依赖"></a>3.1 引入依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rabbitmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>amqp-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-2编写生产者代码发送消息到mq"><a href="#3-2编写生产者代码发送消息到mq" class="headerlink" title="3.2编写生产者代码发送消息到mq"></a>3.2编写生产者代码发送消息到mq</h2><blockquote>
<p>在设置连接工厂的时候;如果没有指定连接的参数则会有默认值;可以去设置虚拟主机,实际业务中一般根据不同的业务设置不同的虚拟主机. </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bgt.rabbitmq.simple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Package: com.bgt.rabbitmq.controller</span></span><br><span class="line"><span class="comment"> * Description： 消息生产者</span></span><br><span class="line"><span class="comment"> * Author: bgt</span></span><br><span class="line"><span class="comment"> * Date: Created in 2020/9/19 5:27 下午</span></span><br><span class="line"><span class="comment"> * Company:</span></span><br><span class="line"><span class="comment"> * Copyright:</span></span><br><span class="line"><span class="comment"> * Version: 0.0.1</span></span><br><span class="line"><span class="comment"> * Modified By:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabbitMQController</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line"><span class="comment">//        1,创建连接工厂(设置RabbitMQ的连接参数) ;</span></span><br><span class="line">        ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line"><span class="comment">//        2.创建连接;</span></span><br><span class="line">        <span class="comment">//主机；默认localhost 连接端口；默认5672   虚拟主机:默认/;  默认用户名:guest</span></span><br><span class="line">        factory.setHost(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        factory.setPort(<span class="number">5672</span>);</span><br><span class="line">        factory.setVirtualHost(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        factory.setUsername(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        Connection connection = factory.newConnection();</span><br><span class="line"><span class="comment">//        3.创建频道;</span></span><br><span class="line">        Channel channel = connection.createChannel();</span><br><span class="line"><span class="comment">//        4.声明队列;</span></span><br><span class="line"><span class="comment">//        参数1:队列名称</span></span><br><span class="line"><span class="comment">//        参数2:是否定义持久化队列(消息会持久化保存在服务器上)</span></span><br><span class="line"><span class="comment">//        参数3:是否独占本连接</span></span><br><span class="line"><span class="comment">//        参数4:是否在不使用的时候队列自动删除</span></span><br><span class="line"><span class="comment">//        参数5:其它参数</span></span><br><span class="line">        channel.queueDeclare(<span class="string">&quot;simple-queue&quot;</span>,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line"><span class="comment">//        5.发送消息;</span></span><br><span class="line">        String msg = <span class="string">&quot;你好,我的mq!&quot;</span>;</span><br><span class="line"><span class="comment">//        参数1:交换机名称；如果没有则指定空字符串(表示使用默认的交换机)</span></span><br><span class="line"><span class="comment">//        参数2:路由key,简单模式中可以使用队列名称</span></span><br><span class="line"><span class="comment">//        参数3:消息其它属性</span></span><br><span class="line"><span class="comment">//        参数4:消息内容</span></span><br><span class="line">        channel.basicPublish(<span class="string">&quot;&quot;</span>,<span class="string">&quot;simple-queue&quot;</span>,<span class="keyword">null</span>,msg.getBytes());</span><br><span class="line"><span class="comment">//        6.关闭资源</span></span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="3-3-编写消费者代码接收消息"><a href="#3-3-编写消费者代码接收消息" class="headerlink" title="3.3 编写消费者代码接收消息"></a>3.3 编写消费者代码接收消息</h2><blockquote>
<p>消费者需要持续监听队列消息,所以不要关闭资源</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bgt.rabbitmq.simple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Package: com.bgt.rabbitmq.simple</span></span><br><span class="line"><span class="comment"> * Description： 简单模式 消费者接收消息</span></span><br><span class="line"><span class="comment"> * Author: bgt</span></span><br><span class="line"><span class="comment"> * Date: Created in 2020/9/19 7:53 下午</span></span><br><span class="line"><span class="comment"> * Company:</span></span><br><span class="line"><span class="comment"> * Copyright:</span></span><br><span class="line"><span class="comment"> * Version: 0.0.1</span></span><br><span class="line"><span class="comment"> * Modified By:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabbitmqConsumer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">// 1,创建连接工厂(设置RabbitMQ的连接参数) ;</span></span><br><span class="line">        ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line"><span class="comment">//        2.创建连接;</span></span><br><span class="line">        <span class="comment">//主机；默认localhost 连接端口；默认5672   虚拟主机:默认/;  默认用户名:guest</span></span><br><span class="line">        factory.setHost(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        factory.setPort(<span class="number">5672</span>);</span><br><span class="line">        factory.setVirtualHost(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        factory.setUsername(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        Connection connection = factory.newConnection();</span><br><span class="line"><span class="comment">//        3.创建频道;</span></span><br><span class="line">        Channel channel = connection.createChannel();</span><br><span class="line"><span class="comment">//        4.声明队列;</span></span><br><span class="line"><span class="comment">//        参数1:队列名称</span></span><br><span class="line"><span class="comment">//        参数2:是否定义持久化队列(消息会持久化保存在服务器上)</span></span><br><span class="line"><span class="comment">//        参数3:是否独占本连接</span></span><br><span class="line"><span class="comment">//        参数4:是否在不使用的时候队列自动删除</span></span><br><span class="line"><span class="comment">//        参数5:其它参数</span></span><br><span class="line">        channel.queueDeclare(<span class="string">&quot;simple-queue&quot;</span>,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line"><span class="comment">//        5.创建消费者接收并处理消息</span></span><br><span class="line">        DefaultConsumer consumer = <span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                <span class="comment">//路由key 交换机 消息id 接受到的消息</span></span><br><span class="line">                System.out.println(envelope.getRoutingKey());</span><br><span class="line">                System.out.println(envelope.getExchange());</span><br><span class="line">                System.out.println(envelope.getDeliveryTag());</span><br><span class="line">                System.out.println(<span class="keyword">new</span> String(body,<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//6 监听队列</span></span><br><span class="line"><span class="comment">//        参数1:队列名</span></span><br><span class="line"><span class="comment">//        参数2:是否要自动确认;设置为true表示消息接收到自动向MQ回复接收到了, MQ则会将消息从队列中删除;</span></span><br><span class="line"><span class="comment">//        如果设置为false则需要手动确认</span></span><br><span class="line"><span class="comment">//        参数3:消费者</span></span><br><span class="line">        channel.basicConsume(<span class="string">&quot;simple-queue&quot;</span>,<span class="keyword">true</span>,consumer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="3-4-测试"><a href="#3-4-测试" class="headerlink" title="3.4 测试"></a>3.4 测试</h2><p>![image-20200919200926479](/Users/boguotong/Library/Application Support/typora-user-images/image-20200919200926479.png)</p>
<h1 id="4-RabbitMQ工作模式"><a href="#4-RabbitMQ工作模式" class="headerlink" title="4.RabbitMQ工作模式"></a>4.RabbitMQ工作模式</h1><h2 id="4-1work-queue工作队列模式"><a href="#4-1work-queue工作队列模式" class="headerlink" title="4.1work queue工作队列模式"></a>4.1work queue工作队列模式</h2><blockquote>
<p>work queues与入门程序的简单模式相比,多了一个或一些消费端,多个消费端共同消费同一个队列中的消息(竞争关系)。</p>
</blockquote>
<p>应用场景: 可以在消费者端处理任务比较耗时的时候;添加对同一个队列的消费者来提高任务处理能力。</p>
<h3 id="4-1-1-生产者循环发送三十条消息"><a href="#4-1-1-生产者循环发送三十条消息" class="headerlink" title="4.1.1 生产者循环发送三十条消息"></a>4.1.1 生产者循环发送三十条消息</h3><h3 id="4-1-2-编写两个消费者"><a href="#4-1-2-编写两个消费者" class="headerlink" title="4.1.2 编写两个消费者"></a>4.1.2 编写两个消费者</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bgt.rabbitmq.workqueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Package: com.bgt.rabbitmq.simple</span></span><br><span class="line"><span class="comment"> * Description： 简单模式 消费者接收消息</span></span><br><span class="line"><span class="comment"> * Author: bgt</span></span><br><span class="line"><span class="comment"> * Date: Created in 2020/9/19 7:53 下午</span></span><br><span class="line"><span class="comment"> * Company:</span></span><br><span class="line"><span class="comment"> * Copyright:</span></span><br><span class="line"><span class="comment"> * Version: 0.0.1</span></span><br><span class="line"><span class="comment"> * Modified By:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabbitmqConsumer1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">// 1,创建连接工厂(设置RabbitMQ的连接参数) ;</span></span><br><span class="line">        ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line"><span class="comment">//        2.创建连接;</span></span><br><span class="line">        <span class="comment">//主机；默认localhost 连接端口；默认5672   虚拟主机:默认/;  默认用户名:guest</span></span><br><span class="line">        factory.setHost(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        factory.setPort(<span class="number">5672</span>);</span><br><span class="line">        factory.setVirtualHost(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        factory.setUsername(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        Connection connection = factory.newConnection();</span><br><span class="line"><span class="comment">//        3.创建频道;</span></span><br><span class="line">        <span class="keyword">final</span> Channel channel = connection.createChannel();</span><br><span class="line"><span class="comment">//        4.声明队列;</span></span><br><span class="line"><span class="comment">//        参数1:队列名称</span></span><br><span class="line"><span class="comment">//        参数2:是否定义持久化队列(消息会持久化保存在服务器上)</span></span><br><span class="line"><span class="comment">//        参数3:是否独占本连接</span></span><br><span class="line"><span class="comment">//        参数4:是否在不使用的时候队列自动删除</span></span><br><span class="line"><span class="comment">//        参数5:其它参数</span></span><br><span class="line">        channel.queueDeclare(<span class="string">&quot;simple-queue&quot;</span>,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//每次可以预取几个消息</span></span><br><span class="line">        channel.basicQos(<span class="number">1</span>);</span><br><span class="line"><span class="comment">//        5.创建消费者接收并处理消息</span></span><br><span class="line">        DefaultConsumer consumer = <span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                <span class="comment">//路由key 交换机 消息id 接受到的消息</span></span><br><span class="line">                System.out.println(<span class="string">&quot;路由key:&quot;</span>+envelope.getRoutingKey());</span><br><span class="line">                System.out.println(<span class="string">&quot;交换机:&quot;</span>+envelope.getExchange());</span><br><span class="line">                System.out.println(<span class="string">&quot;消息id:&quot;</span>+envelope.getDeliveryTag());</span><br><span class="line">                System.out.println(<span class="string">&quot;消费者1---接受到的消息:&quot;</span>+<span class="keyword">new</span> String(body,<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//确认消息</span></span><br><span class="line"><span class="comment">//                参数1:消息id</span></span><br><span class="line"><span class="comment">//                基数2: false表示只有当前这条被处理</span></span><br><span class="line">                channel.basicAck(envelope.getDeliveryTag(),<span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//6 监听队列</span></span><br><span class="line"><span class="comment">//        参数1:队列名</span></span><br><span class="line"><span class="comment">//        参数2:是否要自动确认;设置为true表示消息接收到自动向MQ回复接收到了, MQ则会将消息从队列中删除;</span></span><br><span class="line"><span class="comment">//        如果设置为false则需要手动确认</span></span><br><span class="line"><span class="comment">//        参数3:消费者</span></span><br><span class="line">        channel.basicConsume(<span class="string">&quot;simple-queue&quot;</span>,<span class="keyword">true</span>,consumer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="4-1-3-测试-启动两个消费者-然后启动生产者"><a href="#4-1-3-测试-启动两个消费者-然后启动生产者" class="headerlink" title="4.1.3 测试:启动两个消费者,然后启动生产者"></a>4.1.3 测试:启动两个消费者,然后启动生产者</h3><blockquote>
<p>结论:一个消息只能被一个消费者接收.</p>
</blockquote>
<h1 id="5-订阅模式"><a href="#5-订阅模式" class="headerlink" title="5.订阅模式"></a>5.订阅模式</h1><p>![image-20200919204735420](/Users/boguotong/Library/Application Support/typora-user-images/image-20200919204735420.png)</p>
<ul>
<li>P:生产者,也就是要发送消息的程序,但是不再发送到队列中,而是发给x (交换机)</li>
<li>C:消费者,消息的接受者,会一直等待消息到来。</li>
<li>Queue:消息队列,接收消息、缓存消息。</li>
</ul>
<p><strong>Exchange:交换机</strong>,图中的x,一方面,接收生产者发送的消息。另一方面,知道如何处理消息,例如递交给某个特别队列、递交给所有队列、或是将消息丢弃。到底如何操作,取决于Exchange的类型。Exchang有常见以下3种类型:</p>
<ol>
<li> Fanout:广播,将消息交给所有绑定到交换机的队列</li>
<li>Direct:定向,把消息交给符合指定routing key的队列</li>
<li>Topic:通配符,把消息交给符合routing pattern (路由模式)的队列</li>
</ol>
<p><u>Exchange (交换机)只负责转发消息,不具备存储消息的能力,因此如果没有任何队列与Exchange绑定,或者没有符合路由规则的队列,那么消息会丢失!</u></p>
<h2 id="5-1-pulish-subscribe发布-订阅模式-广播"><a href="#5-1-pulish-subscribe发布-订阅模式-广播" class="headerlink" title="5.1.pulish/subscribe发布/订阅模式(广播)"></a>5.1.pulish/subscribe发布/订阅模式(广播)</h2><p><strong>发布与订阅模式特点</strong>:一个消息可以被多个消费者接收;其实是使用了订阅模式,交换机类型为: fanout广播,一个消费者对应一个队列,该队列只能被一个消费者监听。</p>
<h3 id="5-1-1-生产者"><a href="#5-1-1-生产者" class="headerlink" title="5.1.1 生产者"></a>5.1.1 生产者</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bgt.rabbitmq.ps;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.BuiltinExchangeType;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Package: com.bgt.rabbitmq.controller</span></span><br><span class="line"><span class="comment"> * Description： 发布订阅模式  消息生产者</span></span><br><span class="line"><span class="comment"> * Author: bgt</span></span><br><span class="line"><span class="comment"> * Date: Created in 2020/9/19 5:27 下午</span></span><br><span class="line"><span class="comment"> * Company:</span></span><br><span class="line"><span class="comment"> * Copyright:</span></span><br><span class="line"><span class="comment"> * Version: 0.0.1</span></span><br><span class="line"><span class="comment"> * Modified By:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Producer</span> </span>&#123;</span><br><span class="line">    <span class="comment">//交换机</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String FANOUT_EXCHANGE=<span class="string">&quot;fanout_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//队列名称</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String FANOUT_QUEUE1=<span class="string">&quot;fanout_queue1&quot;</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String FANOUT_QUEUE2=<span class="string">&quot;fanout_queue2&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line"><span class="comment">//       1.创建连接;</span></span><br><span class="line">        ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        <span class="comment">//主机；默认localhost 连接端口；默认5672   虚拟主机:默认/;  默认用户名:guest</span></span><br><span class="line">        factory.setHost(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        factory.setPort(<span class="number">5672</span>);</span><br><span class="line">        factory.setVirtualHost(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        factory.setUsername(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        Connection connection = factory.newConnection();</span><br><span class="line"><span class="comment">//        2.创建频道;</span></span><br><span class="line">        Channel channel = connection.createChannel();</span><br><span class="line">        <span class="comment">//3,声明交换机;参数1:交换机名称,参数2:交换机类型( fanout, direct, topic)</span></span><br><span class="line">        channel. exchangeDeclare (FANOUT_EXCHANGE, BuiltinExchangeType.FANOUT);</span><br><span class="line">        <span class="comment">//4．声明队列；</span></span><br><span class="line">        <span class="comment">/*参数1:队列名称</span></span><br><span class="line"><span class="comment">          参数2:是否定义持久化队列(消息会持久化保存在服务器上)</span></span><br><span class="line"><span class="comment">          参数3:是否独占本连接</span></span><br><span class="line"><span class="comment">         参数4:是否在不使用的时候队列自动删除</span></span><br><span class="line"><span class="comment">         参数5:其它参数</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        channel. queueDeclare (FANOUT_QUEUE1, <span class="keyword">true</span>,  <span class="keyword">false</span>,  <span class="keyword">false</span>,  <span class="keyword">null</span>);</span><br><span class="line">        channel. queueDeclare (FANOUT_QUEUE2, <span class="keyword">true</span>,  <span class="keyword">false</span>,  <span class="keyword">false</span>,  <span class="keyword">null</span>);</span><br><span class="line"><span class="comment">//      5.队列绑定到交换机 参数1:队列名称,参数2:交换机名称,参数3:路由key</span></span><br><span class="line">        channel. queueBind (FANOUT_QUEUE1, FANOUT_EXCHANGE,  <span class="string">&quot;&quot;</span>);</span><br><span class="line">        channel. queueBind (FANOUT_QUEUE2, FANOUT_EXCHANGE,  <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="comment">//6 发送消息</span></span><br><span class="line">        <span class="comment">//参数1:交换机名称;如果没有则指定空字符串(表示使用默认的交换机)参数2:路由key,简单模式中可以使用队列名称</span></span><br><span class="line">        <span class="comment">// 参数3：消息其它属性  参数4:消息内容</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++ )&#123;</span><br><span class="line">            String msg=<span class="string">&quot;hello mq.发布订阅模式--&quot;</span>+i;</span><br><span class="line">            channel.basicPublish(FANOUT_EXCHANGE,<span class="string">&quot;&quot;</span>,<span class="keyword">null</span>,msg.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;已发送消息:&quot;</span>+msg);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        6.关闭资源</span></span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="5-1-2-消费者"><a href="#5-1-2-消费者" class="headerlink" title="5.1.2 消费者"></a>5.1.2 消费者</h3><blockquote>
<p>创建两个消费者</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bgt.rabbitmq.ps;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Package: com.bgt.rabbitmq.simple</span></span><br><span class="line"><span class="comment"> * Description： 发布订阅模式 消费者接收消息</span></span><br><span class="line"><span class="comment"> * Author: bgt</span></span><br><span class="line"><span class="comment"> * Date: Created in 2020/9/19 7:53 下午</span></span><br><span class="line"><span class="comment"> * Company:</span></span><br><span class="line"><span class="comment"> * Copyright:</span></span><br><span class="line"><span class="comment"> * Version: 0.0.1</span></span><br><span class="line"><span class="comment"> * Modified By:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Consumer1</span> </span>&#123;</span><br><span class="line">    <span class="comment">//交换机</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String FANOUT_EXCHANGE=<span class="string">&quot;fanout_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//队列名称</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String FANOUT_QUEUE1=<span class="string">&quot;fanout_queue1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//1.创建连接;</span></span><br><span class="line">        ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        <span class="comment">//主机；默认localhost 连接端口；默认5672   虚拟主机:默认/;  默认用户名:guest</span></span><br><span class="line">        factory.setHost(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        factory.setPort(<span class="number">5672</span>);</span><br><span class="line">        factory.setVirtualHost(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        factory.setUsername(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        Connection connection = factory.newConnection();</span><br><span class="line"><span class="comment">//        2.创建频道;</span></span><br><span class="line">        Channel channel = connection.createChannel();</span><br><span class="line">        <span class="comment">//3 声明交换机</span></span><br><span class="line">        channel.exchangeDeclare(FANOUT_EXCHANGE,BuiltinExchangeType.FANOUT);</span><br><span class="line"><span class="comment">//        4.声明队列;</span></span><br><span class="line"><span class="comment">//        参数1:队列名称</span></span><br><span class="line"><span class="comment">//        参数2:是否定义持久化队列(消息会持久化保存在服务器上)</span></span><br><span class="line"><span class="comment">//        参数3:是否独占本连接</span></span><br><span class="line"><span class="comment">//        参数4:是否在不使用的时候队列自动删除</span></span><br><span class="line"><span class="comment">//        参数5:其它参数</span></span><br><span class="line">        channel.queueDeclare(FANOUT_QUEUE1,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">//5 绑定队列到交换机</span></span><br><span class="line">        channel.queueBind(FANOUT_QUEUE1,FANOUT_EXCHANGE,<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="comment">//        5.创建消费者接收并处理消息</span></span><br><span class="line">        DefaultConsumer consumer = <span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                <span class="comment">//路由key 交换机 消息id 接受到的消息</span></span><br><span class="line">                System.out.println(<span class="string">&quot;路由key:&quot;</span>+envelope.getRoutingKey());</span><br><span class="line">                System.out.println(<span class="string">&quot;交换机:&quot;</span>+envelope.getExchange());</span><br><span class="line">                System.out.println(<span class="string">&quot;消息id:&quot;</span>+envelope.getDeliveryTag());</span><br><span class="line">                System.out.println(<span class="string">&quot;消费者1---接受到的消息:&quot;</span>+<span class="keyword">new</span> String(body,<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//6 监听队列</span></span><br><span class="line"><span class="comment">//        参数1:队列名</span></span><br><span class="line"><span class="comment">//        参数2:是否要自动确认;设置为true表示消息接收到自动向MQ回复接收到了, MQ则会将消息从队列中删除;</span></span><br><span class="line"><span class="comment">//        如果设置为false则需要手动确认</span></span><br><span class="line"><span class="comment">//        参数3:消费者</span></span><br><span class="line">        channel.basicConsume(FANOUT_QUEUE1,<span class="keyword">true</span>,consumer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="5-2routing-路由模式"><a href="#5-2routing-路由模式" class="headerlink" title="5.2routing 路由模式"></a>5.2routing 路由模式</h2><blockquote>
<p>特点:</p>
<ul>
<li>队列与交换机的绑定,不能是任意绑定了,而是要指定一个Routingkey (路由key)</li>
<li>消息的发送方在向Exchange发送消息时,也必须指定消息的Routingkey.</li>
<li>Exchange不再把消息交给每一个绑定的队列,而是根据消息的Routing key进行判断,只有队列的Routingkey与消息的Routing key完全一致,才会接收到消息</li>
</ul>
</blockquote>
<p>![image-20200919212311753](/Users/boguotong/Library/Application Support/typora-user-images/image-20200919212311753.png)</p>
<h3 id="5-2-1-生产者"><a href="#5-2-1-生产者" class="headerlink" title="5.2.1 生产者"></a>5.2.1 生产者</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bgt.rabbitmq.routing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.BuiltinExchangeType;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Package: com.bgt.rabbitmq.controller</span></span><br><span class="line"><span class="comment"> * Description： 路由模式  消息生产者</span></span><br><span class="line"><span class="comment"> * Author: bgt</span></span><br><span class="line"><span class="comment"> * Date: Created in 2020/9/19 5:27 下午</span></span><br><span class="line"><span class="comment"> * Company:</span></span><br><span class="line"><span class="comment"> * Copyright:</span></span><br><span class="line"><span class="comment"> * Version: 0.0.1</span></span><br><span class="line"><span class="comment"> * Modified By:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Producer</span> </span>&#123;</span><br><span class="line">    <span class="comment">//交换机</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String DIRECT_EXCHANGE=<span class="string">&quot;direct_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//队列名称</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String DIRECT_QUEUE_INSERT=<span class="string">&quot;direct_queue_insert&quot;</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String DIRECT_QUEUE_UPDATE=<span class="string">&quot;direct_queue_update&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line"><span class="comment">//       1.创建连接;</span></span><br><span class="line">        ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        <span class="comment">//主机；默认localhost 连接端口；默认5672   虚拟主机:默认/;  默认用户名:guest</span></span><br><span class="line">        factory.setHost(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        factory.setPort(<span class="number">5672</span>);</span><br><span class="line">        factory.setVirtualHost(<span class="string">&quot;myrouting&quot;</span>);</span><br><span class="line">        factory.setUsername(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        Connection connection = factory.newConnection();</span><br><span class="line"><span class="comment">//        2.创建频道;</span></span><br><span class="line">        Channel channel = connection.createChannel();</span><br><span class="line">        <span class="comment">//3,声明交换机;参数1:交换机名称,参数2:交换机类型( fanout, direct, topic)</span></span><br><span class="line">        channel. exchangeDeclare (DIRECT_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        <span class="comment">//4．声明队列；</span></span><br><span class="line">        <span class="comment">/*参数1:队列名称</span></span><br><span class="line"><span class="comment">          参数2:是否定义持久化队列(消息会持久化保存在服务器上)</span></span><br><span class="line"><span class="comment">          参数3:是否独占本连接</span></span><br><span class="line"><span class="comment">         参数4:是否在不使用的时候队列自动删除</span></span><br><span class="line"><span class="comment">         参数5:其它参数</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        channel. queueDeclare (DIRECT_QUEUE_INSERT, <span class="keyword">true</span>,  <span class="keyword">false</span>,  <span class="keyword">false</span>,  <span class="keyword">null</span>);</span><br><span class="line">        channel. queueDeclare (DIRECT_QUEUE_UPDATE, <span class="keyword">true</span>,  <span class="keyword">false</span>,  <span class="keyword">false</span>,  <span class="keyword">null</span>);</span><br><span class="line"><span class="comment">//      5.队列绑定到交换机 参数1:队列名称,参数2:交换机名称,参数3:路由key</span></span><br><span class="line">        channel. queueBind (DIRECT_QUEUE_INSERT, DIRECT_EXCHANGE,  <span class="string">&quot;insert&quot;</span>);</span><br><span class="line">        channel. queueBind (DIRECT_QUEUE_UPDATE, DIRECT_EXCHANGE,  <span class="string">&quot;update&quot;</span>);</span><br><span class="line">        <span class="comment">//6 发送消息</span></span><br><span class="line">        <span class="comment">//参数1:交换机名称;如果没有则指定空字符串(表示使用默认的交换机)参数2:路由key,简单模式中可以使用队列名称</span></span><br><span class="line">        <span class="comment">// 参数3：消息其它属性  参数4:消息内容</span></span><br><span class="line">        String msg=<span class="string">&quot;hello mq.路由模式--routingkey是insert&quot;</span>;</span><br><span class="line">        channel.basicPublish(DIRECT_EXCHANGE,<span class="string">&quot;insert&quot;</span>,<span class="keyword">null</span>,msg.getBytes());</span><br><span class="line">        System.out.println(<span class="string">&quot;已发送消息:&quot;</span>+msg);</span><br><span class="line">        msg=<span class="string">&quot;hello mq.路由模式--routingkey是update&quot;</span>;</span><br><span class="line">        channel.basicPublish(DIRECT_EXCHANGE,<span class="string">&quot;update&quot;</span>,<span class="keyword">null</span>,msg.getBytes());</span><br><span class="line">        System.out.println(<span class="string">&quot;已发送消息:&quot;</span>+msg);</span><br><span class="line"><span class="comment">//        6.关闭资源</span></span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="5-2-2消费者"><a href="#5-2-2消费者" class="headerlink" title="5.2.2消费者"></a>5.2.2消费者</h3><blockquote>
<p>创建两个消费者,分别通过不同的routingkey绑定同一个交换机</p>
</blockquote>
<h4 id="5-2-2-1消费者1"><a href="#5-2-2-1消费者1" class="headerlink" title="5.2.2.1消费者1"></a>5.2.2.1消费者1</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bgt.rabbitmq.routing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Package: com.bgt.rabbitmq.simple</span></span><br><span class="line"><span class="comment"> * Description： 发布订阅模式 消费者接收消息</span></span><br><span class="line"><span class="comment"> * Author: bgt</span></span><br><span class="line"><span class="comment"> * Date: Created in 2020/9/19 7:53 下午</span></span><br><span class="line"><span class="comment"> * Company:</span></span><br><span class="line"><span class="comment"> * Copyright:</span></span><br><span class="line"><span class="comment"> * Version: 0.0.1</span></span><br><span class="line"><span class="comment"> * Modified By:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Consumer1</span> </span>&#123;</span><br><span class="line">    <span class="comment">//交换机</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String DIRECT_EXCHANGE=<span class="string">&quot;direct_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//队列名称</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String DIRECT_QUEUE_INSERT=<span class="string">&quot;direct_queue_insert&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//1.创建连接;</span></span><br><span class="line">        ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        <span class="comment">//主机；默认localhost 连接端口；默认5672   虚拟主机:默认/;  默认用户名:guest</span></span><br><span class="line">        factory.setHost(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        factory.setPort(<span class="number">5672</span>);</span><br><span class="line">        factory.setVirtualHost(<span class="string">&quot;myrouting&quot;</span>);</span><br><span class="line">        factory.setUsername(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        Connection connection = factory.newConnection();</span><br><span class="line"><span class="comment">//        2.创建频道;</span></span><br><span class="line">        Channel channel = connection.createChannel();</span><br><span class="line">        <span class="comment">//3 声明交换机</span></span><br><span class="line">        channel.exchangeDeclare(DIRECT_EXCHANGE,BuiltinExchangeType.DIRECT);</span><br><span class="line"><span class="comment">//        4.声明队列;</span></span><br><span class="line"><span class="comment">//        参数1:队列名称</span></span><br><span class="line"><span class="comment">//        参数2:是否定义持久化队列(消息会持久化保存在服务器上)</span></span><br><span class="line"><span class="comment">//        参数3:是否独占本连接</span></span><br><span class="line"><span class="comment">//        参数4:是否在不使用的时候队列自动删除</span></span><br><span class="line"><span class="comment">//        参数5:其它参数</span></span><br><span class="line">        channel.queueDeclare(DIRECT_QUEUE_INSERT,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">//5 绑定队列到交换机</span></span><br><span class="line">      <span class="comment">//备注:这一步应该可以不要,生产者发送消息时根据routingkey和交换机把消息发送到绑定的队列中,因此消费者只需要监听这个队列就可以获取消息,实测消费者不需要再次绑定交换机/队列/routingkey也可以取到消息,因此这行不需要.</span></span><br><span class="line">       <span class="comment">// channel.queueBind(DIRECT_QUEUE_INSERT,DIRECT_EXCHANGE,&quot;insert&quot;);</span></span><br><span class="line"><span class="comment">//        5.创建消费者接收并处理消息</span></span><br><span class="line">        DefaultConsumer consumer = <span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                <span class="comment">//路由key 交换机 消息id 接受到的消息</span></span><br><span class="line">                System.out.println(<span class="string">&quot;路由key:&quot;</span>+envelope.getRoutingKey());</span><br><span class="line">                System.out.println(<span class="string">&quot;交换机:&quot;</span>+envelope.getExchange());</span><br><span class="line">                System.out.println(<span class="string">&quot;消息id:&quot;</span>+envelope.getDeliveryTag());</span><br><span class="line">                System.out.println(<span class="string">&quot;消费者1---接受到的消息:&quot;</span>+<span class="keyword">new</span> String(body,<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//6 监听队列</span></span><br><span class="line"><span class="comment">//        参数1:队列名</span></span><br><span class="line"><span class="comment">//        参数2:是否要自动确认;设置为true表示消息接收到自动向MQ回复接收到了, MQ则会将消息从队列中删除;</span></span><br><span class="line"><span class="comment">//        如果设置为false则需要手动确认</span></span><br><span class="line"><span class="comment">//        参数3:消费者</span></span><br><span class="line">        channel.basicConsume(DIRECT_QUEUE_INSERT,<span class="keyword">true</span>,consumer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="5-2-2-2消费者2"><a href="#5-2-2-2消费者2" class="headerlink" title="5.2.2.2消费者2"></a>5.2.2.2消费者2</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bgt.rabbitmq.routing;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Package: com.bgt.rabbitmq.simple</span></span><br><span class="line"><span class="comment"> * Description： 发布订阅模式 消费者接收消息</span></span><br><span class="line"><span class="comment"> * Author: bgt</span></span><br><span class="line"><span class="comment"> * Date: Created in 2020/9/19 7:53 下午</span></span><br><span class="line"><span class="comment"> * Company:</span></span><br><span class="line"><span class="comment"> * Copyright:</span></span><br><span class="line"><span class="comment"> * Version: 0.0.1</span></span><br><span class="line"><span class="comment"> * Modified By:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Consumer2</span> </span>&#123;</span><br><span class="line">    <span class="comment">//交换机</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String DIRECT_EXCHANGE=<span class="string">&quot;direct_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//队列名称</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String DIRECT_QUEUE_UPDATE=<span class="string">&quot;direct_queue_update&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//1.创建连接;</span></span><br><span class="line">        ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">        <span class="comment">//主机；默认localhost 连接端口；默认5672   虚拟主机:默认/;  默认用户名:guest</span></span><br><span class="line">        factory.setHost(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        factory.setPort(<span class="number">5672</span>);</span><br><span class="line">        factory.setVirtualHost(<span class="string">&quot;myrouting&quot;</span>);</span><br><span class="line">        factory.setUsername(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        Connection connection = factory.newConnection();</span><br><span class="line"><span class="comment">//        2.创建频道;</span></span><br><span class="line">        Channel channel = connection.createChannel();</span><br><span class="line">        <span class="comment">//3 声明交换机</span></span><br><span class="line">        channel.exchangeDeclare(DIRECT_EXCHANGE,BuiltinExchangeType.DIRECT);</span><br><span class="line"><span class="comment">//        4.声明队列;</span></span><br><span class="line"><span class="comment">//        参数1:队列名称</span></span><br><span class="line"><span class="comment">//        参数2:是否定义持久化队列(消息会持久化保存在服务器上)</span></span><br><span class="line"><span class="comment">//        参数3:是否独占本连接</span></span><br><span class="line"><span class="comment">//        参数4:是否在不使用的时候队列自动删除</span></span><br><span class="line"><span class="comment">//        参数5:其它参数</span></span><br><span class="line">        channel.queueDeclare(DIRECT_QUEUE_UPDATE,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">//5 绑定队列到交换机</span></span><br><span class="line">       <span class="comment">//备注:这一步应该可以不要,生产者发送消息时根据routingkey和交换机把消息发送到绑定的队列中,因此消费者只需要监听这个队列就可以获取消息,实测消费者不需要再次绑定交换机/队列/routingkey也可以取到消息,因此这行不需要.</span></span><br><span class="line">        <span class="comment">//channel.queueBind(DIRECT_QUEUE_UPDATE,DIRECT_EXCHANGE,&quot;update&quot;);</span></span><br><span class="line"><span class="comment">//        5.创建消费者接收并处理消息</span></span><br><span class="line">        DefaultConsumer consumer = <span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                <span class="comment">//路由key 交换机 消息id 接受到的消息</span></span><br><span class="line">                System.out.println(<span class="string">&quot;路由key:&quot;</span>+envelope.getRoutingKey());</span><br><span class="line">                System.out.println(<span class="string">&quot;交换机:&quot;</span>+envelope.getExchange());</span><br><span class="line">                System.out.println(<span class="string">&quot;消息id:&quot;</span>+envelope.getDeliveryTag());</span><br><span class="line">                System.out.println(<span class="string">&quot;消费者1---接受到的消息:&quot;</span>+<span class="keyword">new</span> String(body,<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//6 监听队列</span></span><br><span class="line"><span class="comment">//        参数1:队列名</span></span><br><span class="line"><span class="comment">//        参数2:是否要自动确认;设置为true表示消息接收到自动向MQ回复接收到了, MQ则会将消息从队列中删除;</span></span><br><span class="line"><span class="comment">//        如果设置为false则需要手动确认</span></span><br><span class="line"><span class="comment">//        参数3:消费者</span></span><br><span class="line">        channel.basicConsume(DIRECT_QUEUE_UPDATE,<span class="keyword">true</span>,consumer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="5-3-topics通配符模式"><a href="#5-3-topics通配符模式" class="headerlink" title="5.3 topics通配符模式"></a>5.3 topics通配符模式</h2><blockquote>
<p>Topic类型与Direct相比,都是可以根据Routingkey把消息路由到不同的队列。只不过Topic类型Exchange可以让队列在绑定Routing key的时候使用通配符!<br>Routingkey一般都是有一个或多个单词组成,多个单词之间以”.”分割,例如: item.inser</p>
</blockquote>
<p><strong>通配符规则:</strong></p>
<ul>
<li>#：匹配一个或多个词</li>
<li>*:   匹配不多不少恰好1个词</li>
</ul>
<p><strong>举例:</strong></p>
<ul>
<li>item.#:能够匹配item.insert.abc或者item.insertitem.</li>
<li>*:只能匹配item.insert</li>
</ul>
<p>![image-20200919215028302](/Users/boguotong/Library/Application Support/typora-user-images/image-20200919215028302.png)</p>
<p>![image-20200919215432002](/Users/boguotong/Library/Application Support/typora-user-images/image-20200919215432002.png)</p>
<h3 id="5-3-1生产者"><a href="#5-3-1生产者" class="headerlink" title="5.3.1生产者"></a>5.3.1生产者</h3><p>基于路由模式代码改造如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//声明交换机;交换机类型改为通配符模式</span></span><br><span class="line">channel.exchangeDeclare (TOPIC EXCHAGE, BuiltinExchangeType. TOPIC) :</span><br><span class="line"></span><br><span class="line"><span class="comment">//发送三条消息指定不同的routingkey</span></span><br><span class="line">channel.basicPublish (TOPIC EXCHAGE, routingKey: <span class="string">&quot;item.insert&quot;</span>, props: <span class="keyword">null</span>, message.getBytes());</span><br><span class="line">channel.basicPublish (TOPIC EXCHAGE, routingKey: <span class="string">&quot;item.update&quot;</span>, props: <span class="keyword">null</span>, message.getBytes());</span><br><span class="line">channel.basicPublish (TOPIC EXCHAGE, routingKey: <span class="string">&quot;item.delete&quot;</span>, props: <span class="keyword">null</span>, message.getBytes());</span><br></pre></td></tr></table></figure>
<h3 id="5-3-2-消费者"><a href="#5-3-2-消费者" class="headerlink" title="5.3.2 消费者"></a>5.3.2 消费者</h3><blockquote>
<p>两个消费者</p>
</blockquote>
<p> 基于路由模式代码改造如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//声明交换机;交换机类型改为通配符模式</span></span><br><span class="line">channel.exchangeDeclare (Producer. TOPIC EXCHAGE, BuiltinExchangeType.TOPIC);</span><br><span class="line"></span><br><span class="line"><span class="comment">//消费者1绑定这两个指定routingkey</span></span><br><span class="line">channel.queueBind (Producer.TOPIC_QUEUE1, Producer.TOPIC_EXCHAGE, <span class="string">&quot;item.update&quot;</span>);</span><br><span class="line">channel.queueBind (Producer.TOPIC_QUEUE1, Producer.TOPIC_EXCHAGE, <span class="string">&quot;item.delete&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//消费者2绑定通配符模式的routingkey</span></span><br><span class="line">channel.queueBind (Producer.TOPIC_QUEUE2, Producer.TOPIC_EXCHAGE, <span class="string">&quot;item.*&quot;</span>);</span><br></pre></td></tr></table></figure>
<h2 id="5-4-rabbitmq模式总结"><a href="#5-4-rabbitmq模式总结" class="headerlink" title="5.4 rabbitmq模式总结"></a>5.4 rabbitmq模式总结</h2><p>![image-20200919221146270](/Users/boguotong/Library/Application Support/typora-user-images/image-20200919221146270.png)</p>
<h1 id="6-springboot整合rabbitmq"><a href="#6-springboot整合rabbitmq" class="headerlink" title="6.springboot整合rabbitmq"></a>6.springboot整合rabbitmq</h1><blockquote>
<p>Spring Boot提供了对于AMQP的整合;可以使月RabbitTemplate发送消息;可以使用@RabbitListener注解接收消息。</p>
<p><strong>示例通配符模式</strong></p>
</blockquote>
<h2 id="6-1-生产者工程"><a href="#6-1-生产者工程" class="headerlink" title="6.1 生产者工程"></a>6.1 生产者工程</h2><h3 id="6-1-1-添加依赖"><a href="#6-1-1-添加依赖" class="headerlink" title="6.1.1 添加依赖"></a>6.1.1 添加依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!--rabbitmq发送消息核心依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.bootk/groupId&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amgp&lt;/artifactrds</span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--rabbitmq发送消息测试依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.bootk/groupId&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test&lt;/artifactrds</span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>	</span><br></pre></td></tr></table></figure>


<h3 id="6-1-2-添加配置文件"><a href="#6-1-2-添加配置文件" class="headerlink" title="6.1.2 添加配置文件"></a>6.1.2 添加配置文件</h3><blockquote>
<p>application.properties配置rabbitmq连接信息</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">	<span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> </span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">guest</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">guest</span></span><br></pre></td></tr></table></figure>
<h3 id="6-1-3-创建配置类"><a href="#6-1-3-创建配置类" class="headerlink" title="6.1.3 创建配置类"></a>6.1.3 创建配置类</h3><p>![image-20200919222543932](/Users/boguotong/Library/Application Support/typora-user-images/image-20200919222543932.png)</p>
<h3 id="6-1-4-创建发送消息类"><a href="#6-1-4-创建发送消息类" class="headerlink" title="6.1.4 创建发送消息类"></a>6.1.4 创建发送消息类</h3><p> ![image-20200919223251686](/Users/boguotong/Library/Application Support/typora-user-images/image-20200919223251686.png)</p>
<h2 id="6-2-消费者工程"><a href="#6-2-消费者工程" class="headerlink" title="6.2 消费者工程"></a>6.2 消费者工程</h2><h3 id="6-2-1-添加依赖"><a href="#6-2-1-添加依赖" class="headerlink" title="6.2.1 添加依赖"></a>6.2.1 添加依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--rabbitmq发送消息核心依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.bootk/groupId&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amgp&lt;/artifactrds</span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="6-2-2-添加配置文件"><a href="#6-2-2-添加配置文件" class="headerlink" title="6.2.2 添加配置文件"></a>6.2.2 添加配置文件</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">	<span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> </span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">guest</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">guest</span></span><br></pre></td></tr></table></figure>
<h3 id="6-2-3-编写消息监听器类"><a href="#6-2-3-编写消息监听器类" class="headerlink" title="6.2.3 编写消息监听器类"></a>6.2.3 编写消息监听器类</h3><h1 id="image-20200919222909121-Users-boguotong-Library-Application-Support-typora-user-images-image-20200919222909121-png"><a href="#image-20200919222909121-Users-boguotong-Library-Application-Support-typora-user-images-image-20200919222909121-png" class="headerlink" title="![image-20200919222909121](/Users/boguotong/Library/Application Support/typora-user-images/image-20200919222909121.png)"></a>![image-20200919222909121](/Users/boguotong/Library/Application Support/typora-user-images/image-20200919222909121.png)</h1>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/04/rabbitmq%E5%85%A5%E9%97%A8%E4%BD%BF%E7%94%A8/" data-id="ckke5nr57009hcl8g8432d7i8" data-title="rabbitmq入门使用" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mq/" rel="tag">mq</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" rel="tag">消息队列</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-springcloud入门(1)" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/04/springcloud%E5%85%A5%E9%97%A8(1)/" class="article-date">
  <time class="dt-published" datetime="2020-12-04T02:10:17.000Z" itemprop="datePublished">2020-12-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/springCloud/">springCloud</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/04/springcloud%E5%85%A5%E9%97%A8(1)/">springCloud入门</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="1-RestTemplate的介绍"><a href="#1-RestTemplate的介绍" class="headerlink" title="1.RestTemplate的介绍"></a>1.RestTemplate的介绍</h1><p>一般情况下有如下三种http客户端工具类包都可以方便的进行http服务调用:</p>
<ul>
<li>httpClient</li>
<li>okHttp</li>
<li>JDK原生URLConnection</li>
</ul>
<p>spring提供了RestTemplate的工具类对上述的3种http客户端工具类进行了封装,可在spring项目中使用RestTemplate进行服务调用。</p>
<h2 id="1-1启动类注入RestTemplate"><a href="#1-1启动类注入RestTemplate" class="headerlink" title="1.1启动类注入RestTemplate"></a>1.1启动类注入RestTemplate</h2><p><img src="http://mele.cool//image-20200920144117052.png" alt="image-20200920144117052"></p>
<h2 id="1-2-代码中使用"><a href="#1-2-代码中使用" class="headerlink" title="1.2 代码中使用"></a>1.2 代码中使用</h2><p><img src="http://mele.cool//image-20200920144301465.png" alt="image-20200920144301465"></p>
<h1 id="2-入门工程"><a href="#2-入门工程" class="headerlink" title="2.入门工程"></a>2.入门工程</h1><p><img src="http://mele.cool//image-20200920145002197.png" alt="image-20200920145002197"></p>
<h2 id="2-1-父工程依赖"><a href="#2-1-父工程依赖" class="headerlink" title="2.1 父工程依赖"></a>2.1 父工程依赖</h2><blockquote>
<p>通过scope的import可以继承spring-cloud-dependencies工程中的依赖</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.bgt<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springcloud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>user-service<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>user-consumer<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span><span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>Greenwich.SR1<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper.starter.version</span>&gt;</span>2.1.5<span class="tag">&lt;/<span class="name">mapper.starter.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            spring-cloud &lt;scope&gt;import&lt;/scope&gt;此处配置意为本项目不仅继承springboot2.1.5.RELEASE的依赖坐标,同时也继承spring-cloud-dependencies Greenwich.SR1的依赖坐标--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            通用mapper--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>tk.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mapper.starter.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-2-user-service-生产者"><a href="#2-2-user-service-生产者" class="headerlink" title="2.2 user-service 生产者"></a>2.2 user-service 生产者</h2><h3 id="2-2-1依赖"><a href="#2-2-1依赖" class="headerlink" title="2.2.1依赖"></a>2.2.1依赖</h3><blockquote>
<p>版本号在父工程中管理,子工程不需要声明版本号</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--            通用mapper--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>tk.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            mysql--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-2-配置文件"><a href="#2-2-2-配置文件" class="headerlink" title="2.2.2 配置文件"></a>2.2.2 配置文件</h3><p><img src="http://mele.cool//image-20200920170815660.png" alt="image-20200920170815660"></p>
<h3 id="2-2-3-创建实体类及数据库表"><a href="#2-2-3-创建实体类及数据库表" class="headerlink" title="2.2.3 创建实体类及数据库表"></a>2.2.3 创建实体类及数据库表</h3><h3 id="2-2-4-启动类加mybatis注解"><a href="#2-2-4-启动类加mybatis注解" class="headerlink" title="2.2.4 启动类加mybatis注解"></a>2.2.4 启动类加mybatis注解</h3><p><img src="http://mele.cool//image-20200920170950272.png" alt="image-20200920170950272"></p>
<h3 id="2-2-5-编写mapper"><a href="#2-2-5-编写mapper" class="headerlink" title="2.2.5 编写mapper"></a>2.2.5 编写mapper</h3><p><img src="http://mele.cool//image-20200920171020058.png" alt="image-20200920171020058"></p>
<h3 id="2-2-6-编写业务类service"><a href="#2-2-6-编写业务类service" class="headerlink" title="2.2.6 编写业务类service"></a>2.2.6 编写业务类service</h3><p><img src="http://mele.cool//image-20200920171117875.png" alt="image-20200920171117875"></p>
<h3 id="2-2-7-编写处理器controller"><a href="#2-2-7-编写处理器controller" class="headerlink" title="2.2.7 编写处理器controller"></a>2.2.7 编写处理器controller</h3><p><img src="http://mele.cool//image-20200920171207931.png" alt="image-20200920171207931"></p>
<h3 id="2-2-8-测试"><a href="#2-2-8-测试" class="headerlink" title="2.2.8 测试"></a>2.2.8 测试</h3><p><img src="http://mele.cool//image-20200920171249805.png" alt="image-20200920171249805"></p>
<h2 id="2-3-user-consumer-消费者"><a href="#2-3-user-consumer-消费者" class="headerlink" title="2.3 user-consumer 消费者"></a>2.3 user-consumer 消费者</h2><h3 id="2-3-1-添加依赖"><a href="#2-3-1-添加依赖" class="headerlink" title="2.3.1 添加依赖"></a>2.3.1 添加依赖</h3><p><img src="http://mele.cool//image-20200920171603411.png" alt="image-20200920171603411"></p>
<h3 id="2-3-2-启动类注入RestTemplate"><a href="#2-3-2-启动类注入RestTemplate" class="headerlink" title="2.3.2 启动类注入RestTemplate"></a>2.3.2 启动类注入RestTemplate</h3><p><img src="http://mele.cool//image-20200920171647566.png" alt="image-20200920171647566"></p>
<h3 id="2-3-3-编写controller"><a href="#2-3-3-编写controller" class="headerlink" title="2.3.3 编写controller"></a>2.3.3 编写controller</h3><blockquote>
<p>编写用到的user类</p>
</blockquote>
<p><img src="http://mele.cool//image-20200920171850133.png" alt="image-20200920171850133"></p>
<h3 id="2-3-4-测试"><a href="#2-3-4-测试" class="headerlink" title="2.3.4 测试"></a>2.3.4 测试</h3><p><img src="http://mele.cool//image-20200920171930021.png" alt="image-20200920171930021"></p>
<h2 id="2-4-问题"><a href="#2-4-问题" class="headerlink" title="2.4 问题"></a>2.4 问题</h2><p><img src="http://mele.cool//image-20200920172051654.png" alt="image-20200920172051654"></p>
<blockquote>
<p>上述的问题都可以通过Spring Cloud的各种组件解决。</p>
</blockquote>
<h1 id="3-Eureka-注册中心"><a href="#3-Eureka-注册中心" class="headerlink" title="3.Eureka 注册中心"></a>3.Eureka 注册中心</h1><p><img src="http://mele.cool//image-20200920172332720.png" alt="image-20200920172332720"></p>
<p><img src="http://mele.cool//image-20200920172535724.png" alt="image-20200920172535724"></p>
<blockquote>
<p>Eureka的主要功能是进行服务管理,定期检查服务状态,返回服务地址列表。</p>
</blockquote>
<h2 id="3-1-搭建eureka-server工程"><a href="#3-1-搭建eureka-server工程" class="headerlink" title="3.1 搭建eureka-server工程"></a>3.1 搭建eureka-server工程</h2><blockquote>
<p>Eureka是服务注册中心,只做服务注册;自身并不提供服务也不消费服务。可以搭建web工程使用Eureka ,可以使用Spring Boot方式搭建。</p>
</blockquote>
<p><img src="http://mele.cool//image-20200920172725325.png" alt="image-20200920172725325"></p>
<h3 id="3-1-1-依赖"><a href="#3-1-1-依赖" class="headerlink" title="3.1.1 依赖"></a>3.1.1 依赖</h3><p><img src="http://mele.cool//image-20200920172752229.png" alt="image-20200920172752229"></p>
<h3 id="3-1-2-启动类"><a href="#3-1-2-启动类" class="headerlink" title="3.1.2 启动类"></a>3.1.2 启动类</h3><p><img src="http://mele.cool//image-20200920172837013.png" alt="image-20200920172837013"></p>
<h3 id="3-1-3-配置文件"><a href="#3-1-3-配置文件" class="headerlink" title="3.1.3 配置文件"></a>3.1.3 配置文件</h3><p><img src="http://mele.cool//image-20200920173002950.png" alt="image-20200920173002950"></p>
<h3 id="3-1-4-启动测试-能否查看到"><a href="#3-1-4-启动测试-能否查看到" class="headerlink" title="3.1.4 启动测试,能否查看到"></a>3.1.4 启动测试,能否查看到</h3><p><img src="http://mele.cool//image-20200920173033190.png" alt="image-20200920173033190"></p>
<h2 id="3-2-服务注册与发现"><a href="#3-2-服务注册与发现" class="headerlink" title="3.2 服务注册与发现"></a>3.2 服务注册与发现</h2><blockquote>
<p><strong>目标:将user-service的服务注册到eureka并在consumer-demo中可以根据服务名称调用</strong></p>
</blockquote>
<p><img src="http://mele.cool//image-20200920173328373.png" alt="image-20200920173328373"></p>
<h3 id="3-2-1-生产者工程user-serivce依赖"><a href="#3-2-1-生产者工程user-serivce依赖" class="headerlink" title="3.2.1 生产者工程user-serivce依赖"></a>3.2.1 生产者工程user-serivce依赖</h3><p><img src="http://mele.cool//image-20200920173352540.png" alt="image-20200920173352540"></p>
<h3 id="3-2-2-生产者工程user-serivce启动器修改"><a href="#3-2-2-生产者工程user-serivce启动器修改" class="headerlink" title="3.2.2 生产者工程user-serivce启动器修改"></a>3.2.2 生产者工程user-serivce启动器修改</h3><p><img src="http://mele.cool//image-20200920173440400.png" alt="image-20200920173440400"></p>
<h3 id="3-2-3-生产者工程user-serivce修改配置文件"><a href="#3-2-3-生产者工程user-serivce修改配置文件" class="headerlink" title="3.2.3 生产者工程user-serivce修改配置文件"></a>3.2.3 生产者工程user-serivce修改配置文件</h3><p><img src="http://mele.cool//image-20200920173517140.png" alt="image-20200920173517140"></p>
<h3 id="3-2-4-生产者工程user-serivce启动测试测试"><a href="#3-2-4-生产者工程user-serivce启动测试测试" class="headerlink" title="3.2.4 生产者工程user-serivce启动测试测试"></a>3.2.4 生产者工程user-serivce启动测试测试</h3><blockquote>
<p>启动eureka服务,启动user-service服务,成功标准是在eureka界面可以看到user-service的服务注册成功.</p>
</blockquote>
<p><img src="http://mele.cool//image-20200920173722437.png" alt="image-20200920173722437"></p>
<h3 id="3-2-5-消费者工程user-consumer添加依赖"><a href="#3-2-5-消费者工程user-consumer添加依赖" class="headerlink" title="3.2.5 消费者工程user-consumer添加依赖"></a>3.2.5 消费者工程user-consumer添加依赖</h3><p><img src="http://mele.cool//image-20200920173911001.png" alt="image-20200920173911001"></p>
<h3 id="3-2-6-消费者工程user-consumer启动类修改"><a href="#3-2-6-消费者工程user-consumer启动类修改" class="headerlink" title="3.2.6 消费者工程user-consumer启动类修改"></a>3.2.6 消费者工程user-consumer启动类修改</h3><p><img src="http://mele.cool//image-20200920174001298.png" alt="image-20200920174001298"></p>
<h3 id="3-2-7-消费者工程user-consumer配置文件修改"><a href="#3-2-7-消费者工程user-consumer配置文件修改" class="headerlink" title="3.2.7 消费者工程user-consumer配置文件修改"></a>3.2.7 消费者工程user-consumer配置文件修改</h3><p><img src="http://mele.cool//image-20200920174042219.png" alt="image-20200920174042219"></p>
<h3 id="3-2-8-消费者工程user-consumer处理器controller修改"><a href="#3-2-8-消费者工程user-consumer处理器controller修改" class="headerlink" title="3.2.8 消费者工程user-consumer处理器controller修改"></a>3.2.8 消费者工程user-consumer处理器controller修改</h3><p><img src="http://mele.cool//image-20200920174501114.png" alt="image-20200920174501114"></p>
<h3 id="3-2-9-测试"><a href="#3-2-9-测试" class="headerlink" title="3.2.9 测试"></a>3.2.9 测试</h3><h2 id="3-3-Eureka-Server高可用配置"><a href="#3-3-Eureka-Server高可用配置" class="headerlink" title="3.3 Eureka Server高可用配置"></a>3.3 Eureka Server高可用配置</h2><p><img src="http://mele.cool//image-20200920175231122.png" alt="image-20200920175231122"></p>
<p><img src="http://mele.cool//image-20200920175352093.png" alt="image-20200920175352093"></p>
<h3 id="3-3-1-eureka-server工程1修改配置文件"><a href="#3-3-1-eureka-server工程1修改配置文件" class="headerlink" title="3.3.1 eureka-server工程1修改配置文件"></a>3.3.1 eureka-server工程1修改配置文件</h3><blockquote>
<p>${port:10086}  表示如果提供port就用提供的port,否则使用10086</p>
</blockquote>
<p><img src="http://mele.cool//image-20200920175601619.png" alt="image-20200920175601619"></p>
<h3 id="3-3-2-修改启动项-并复制一个新的启动器-相互注册"><a href="#3-3-2-修改启动项-并复制一个新的启动器-相互注册" class="headerlink" title="3.3.2 修改启动项,并复制一个新的启动器,相互注册."></a>3.3.2 修改启动项,并复制一个新的启动器,相互注册.</h3><p><img src="http://mele.cool//image-20200920175835585.png" alt="image-20200920175835585"></p>
<p><img src="http://mele.cool//image-20200920175956133.png" alt="image-20200920175956133"> </p>
<h3 id="3-3-3-启动两个启动类-查看效果"><a href="#3-3-3-启动两个启动类-查看效果" class="headerlink" title="3.3.3 启动两个启动类,查看效果"></a>3.3.3 启动两个启动类,查看效果</h3><p><img src="http://mele.cool//image-20200920180210637.png" alt="image-20200920180210637"></p>
<p><img src="http://mele.cool//image-20200920180253572.png" alt="image-20200920180253572"></p>
<h3 id="3-3-4-启动user-service"><a href="#3-3-4-启动user-service" class="headerlink" title="3.3.4  启动user-service"></a>3.3.4  启动user-service</h3><blockquote>
<p>本服务会自动注册到10086 10087两个eureka-server中</p>
<p>也可以在配置文件中配置注册到多台eureka-server中</p>
</blockquote>
<p><img src="http://mele.cool//image-20200920180419824.png" alt="image-20200920180419824"></p>
<h2 id="3-4-Eureka客户端与服务端配置"><a href="#3-4-Eureka客户端与服务端配置" class="headerlink" title="3.4 Eureka客户端与服务端配置"></a>3.4 Eureka客户端与服务端配置</h2><p><img src="http://mele.cool//image-20200920180739046.png" alt="image-20200920180739046"></p>
<h3 id="3-4-1-服务提供者设置-使用ip地址"><a href="#3-4-1-服务提供者设置-使用ip地址" class="headerlink" title="3.4.1 服务提供者设置 使用ip地址"></a>3.4.1 服务提供者设置 使用ip地址</h3><p><img src="http://mele.cool//image-20200920180818207.png" alt="image-20200920180818207"></p>
<p><img src="http://mele.cool//image-20200920203745777.png" alt="image-20200920203745777"></p>
<h3 id="3-4-2-服务提供者服务续约配置"><a href="#3-4-2-服务提供者服务续约配置" class="headerlink" title="3.4.2 服务提供者服务续约配置"></a>3.4.2 服务提供者服务续约配置</h3><p><img src="http://mele.cool//image-20200920203940965.png" alt="image-20200920203940965"></p>
<p><img src="http://mele.cool//image-20200920204216306.png" alt="image-20200920204216306"></p>
<blockquote>
<p>并非服务失效时间到了就一定会剔除,只是说时间到了表示该服务可以被剔除,具体啥时剔除需要eureka-server扫描到(默认60秒扫描一次). </p>
</blockquote>
<h3 id="3-4-3-服务消费者设置拉取服务列表间隔时间"><a href="#3-4-3-服务消费者设置拉取服务列表间隔时间" class="headerlink" title="3.4.3 服务消费者设置拉取服务列表间隔时间"></a>3.4.3 服务消费者设置拉取服务列表间隔时间</h3><p><img src="http://mele.cool//image-20200920204721072.png" alt="image-20200920204721072"></p>
<h3 id="3-4-4-eureka-server服务端设置失效剔除时间间隔"><a href="#3-4-4-eureka-server服务端设置失效剔除时间间隔" class="headerlink" title="3.4.4 eureka-server服务端设置失效剔除时间间隔"></a>3.4.4 eureka-server服务端设置失效剔除时间间隔</h3><p><img src="http://mele.cool//image-20200920205004580.png" alt="image-20200920205004580"></p>
<h3 id="3-4-5-eureka-server服务端设置关闭自我保护模式-开发中推荐设置"><a href="#3-4-5-eureka-server服务端设置关闭自我保护模式-开发中推荐设置" class="headerlink" title="3.4.5 eureka-server服务端设置关闭自我保护模式(开发中推荐设置)"></a>3.4.5 eureka-server服务端设置关闭自我保护模式(开发中推荐设置)</h3><p><img src="http://mele.cool//image-20200920205329811.png" alt="image-20200920205329811"></p>
<h1 id="4-Ribbon负载均衡"><a href="#4-Ribbon负载均衡" class="headerlink" title="4.Ribbon负载均衡"></a>4.Ribbon负载均衡</h1><p><img src="http://mele.cool//image-20200920211541115.png" alt="image-20200920211541115"></p>
<blockquote>
<p>依赖来自于eureka.</p>
<p>需求:可以使用RestTemplate访问<a target="_blank" rel="noopener" href="http://user-service/user/8%E8%8E%B7%E5%8F%96%E6%9C%8D%E5%8A%A1%E6%95%B0%E6%8D%AE%E3%80%82">http://user-service/user/8获取服务数据。</a></p>
</blockquote>
<p><img src="http://mele.cool//image-20200920211927539.png" alt="image-20200920211927539"></p>
<h2 id="4-1-启动两个user-serivce"><a href="#4-1-启动两个user-serivce" class="headerlink" title="4.1 启动两个user-serivce"></a>4.1 启动两个user-serivce</h2><h2 id="4-2-服务消费者启动类添加注解"><a href="#4-2-服务消费者启动类添加注解" class="headerlink" title="4.2 服务消费者启动类添加注解"></a>4.2 服务消费者启动类添加注解</h2><p><img src="http://mele.cool//image-20200920212132772.png" alt="image-20200920212132772"></p>
<h2 id="4-3-服务消费者controller修改"><a href="#4-3-服务消费者controller修改" class="headerlink" title="4.3 服务消费者controller修改"></a>4.3 服务消费者controller修改</h2><p><img src="http://mele.cool//image-20200920212242748.png" alt="image-20200920212242748"></p>
<h1 id="5-hystrix熔断器-服务消费者"><a href="#5-hystrix熔断器-服务消费者" class="headerlink" title="5.hystrix熔断器(服务消费者)"></a>5.hystrix熔断器(服务消费者)</h1><p><img src="http://mele.cool//image-20200923232356990.png" alt="image-20200923232356990"></p>
<p>雪崩问题:</p>
<p><img src="http://mele.cool//image-20200923232420682.png" alt="image-20200923232420682"></p>
<h2 id="5-1-开启熔断"><a href="#5-1-开启熔断" class="headerlink" title="5.1 开启熔断"></a>5.1 开启熔断</h2><p><img src="http://mele.cool//image-20200920213406074.png" alt="image-20200920213406074"></p>
<h3 id="5-1-1-依赖"><a href="#5-1-1-依赖" class="headerlink" title="5.1.1 依赖"></a>5.1.1 依赖</h3><p><img src="http://mele.cool//image-20200920213453131.png" alt="image-20200920213453131"></p>
<h3 id="5-1-2-服务消费者开启熔断"><a href="#5-1-2-服务消费者开启熔断" class="headerlink" title="5.1.2 服务消费者开启熔断"></a>5.1.2 服务消费者开启熔断</h3><p><img src="http://mele.cool//image-20200920213517996.png" alt="image-20200920213517996"></p>
<h3 id="5-1-3-服务消费者编写降级逻辑"><a href="#5-1-3-服务消费者编写降级逻辑" class="headerlink" title="5.1.3 服务消费者编写降级逻辑"></a>5.1.3 服务消费者编写降级逻辑</h3><p><img src="http://mele.cool//image-20200920213744472.png" alt="image-20200920213744472"></p>
<h3 id="5-1-4-服务消费者默认降级逻辑"><a href="#5-1-4-服务消费者默认降级逻辑" class="headerlink" title="5.1.4 服务消费者默认降级逻辑"></a>5.1.4 服务消费者默认降级逻辑</h3><blockquote>
<p>5.1.3中针对单个方法的降级逻辑,如果方法多了,每个方法都这么写不现实,可以根据类设置默认降级回调方法</p>
</blockquote>
<p><img src="http://mele.cool//image-20200920214231894.png" alt="image-20200920214231894"></p>
<p><img src="http://mele.cool//image-20200920214304060.png" alt="image-20200920214304060"></p>
<h3 id="5-1-5-服务消费者设置熔断器hystrix超时时间"><a href="#5-1-5-服务消费者设置熔断器hystrix超时时间" class="headerlink" title="5.1.5 服务消费者设置熔断器hystrix超时时间"></a>5.1.5 服务消费者设置熔断器hystrix超时时间</h3><p><img src="http://mele.cool//image-20200920214513101.png" alt="image-20200920214513101"></p>
<h2 id="5-2-熔断原理"><a href="#5-2-熔断原理" class="headerlink" title="5.2 熔断原理"></a>5.2 熔断原理</h2><p><img src="http://mele.cool//image-20200920215010560.png" alt="image-20200920215010560"><img src="http://mele.cool//image-20200920215206312.png" alt="image-20200920215206312"><img src="http://mele.cool//image-20200920215222319.png" alt="image-20200920215222319"></p>
<p>  修改熔断器阈值:</p>
<p><img src="http://mele.cool//image-20200920215607448.png" alt="image-20200920215607448"></p>
<h1 id="6-Feign"><a href="#6-Feign" class="headerlink" title="6. Feign"></a>6. Feign</h1><p><img src="http://mele.cool//image-20200920215753322.png" alt="image-20200920215753322"></p>
<h2 id="6-1-使用"><a href="#6-1-使用" class="headerlink" title="6.1 使用"></a>6.1 使用</h2><p><img src="http://mele.cool//image-20200920215855740.png" alt="image-20200920215855740"></p>
<h3 id="6-1-1-消费者工程添加依赖"><a href="#6-1-1-消费者工程添加依赖" class="headerlink" title="6.1.1 消费者工程添加依赖"></a>6.1.1 消费者工程添加依赖</h3><p><img src="http://mele.cool//image-20200920215941454.png" alt="image-20200920215941454"></p>
<h3 id="6-1-2-修改启动类-开启feign功能"><a href="#6-1-2-修改启动类-开启feign功能" class="headerlink" title="6.1.2 修改启动类,开启feign功能"></a>6.1.2 修改启动类,开启feign功能</h3><p><img src="http://mele.cool//image-20200920220030594.png" alt="image-20200920220030594"></p>
<h3 id="6-1-3-编写feign客户端代码"><a href="#6-1-3-编写feign客户端代码" class="headerlink" title="6.1.3 编写feign客户端代码"></a>6.1.3 编写feign客户端代码</h3><p><img src="http://mele.cool//image-20200920220209633.png" alt="image-20200920220209633"></p>
<h3 id="6-1-4-编写处理器controller"><a href="#6-1-4-编写处理器controller" class="headerlink" title="6.1.4 编写处理器controller"></a>6.1.4 编写处理器controller</h3><p><img src="http://mele.cool//image-20200920220336461.png" alt="image-20200920220336461"></p>
<h3 id="6-1-5-测试"><a href="#6-1-5-测试" class="headerlink" title="6.1.5 测试"></a>6.1.5 测试</h3><p><img src="http://mele.cool//image-20200920220426686.png" alt="image-20200920220426686"></p>
<h2 id="6-2feign负载均衡及熔断"><a href="#6-2feign负载均衡及熔断" class="headerlink" title="6.2feign负载均衡及熔断"></a>6.2feign负载均衡及熔断</h2><p><img src="http://mele.cool//image-20200920220645044.png" alt="image-20200920220645044"></p>
<h3 id="6-2-1-负载均衡"><a href="#6-2-1-负载均衡" class="headerlink" title="6.2.1 负载均衡"></a>6.2.1 负载均衡</h3><p><img src="http://mele.cool//image-20200920220707935.png" alt="image-20200920220707935"></p>
<p><img src="http://mele.cool//image-20200920220754005.png" alt="image-20200920220754005"></p>
<h3 id="6-2-2-hystrix支持-熔断"><a href="#6-2-2-hystrix支持-熔断" class="headerlink" title="6.2.2 hystrix支持  熔断"></a>6.2.2 hystrix支持  熔断</h3><h4 id="6-2-2-1-服务消费者修改配置文件开启feign熔断功能"><a href="#6-2-2-1-服务消费者修改配置文件开启feign熔断功能" class="headerlink" title="6.2.2.1 服务消费者修改配置文件开启feign熔断功能"></a>6.2.2.1 服务消费者修改配置文件开启feign熔断功能</h4><p><img src="http://mele.cool//image-20200920221055277.png" alt="image-20200920221055277"></p>
<h4 id="6-2-2-2-编写熔断降级类"><a href="#6-2-2-2-编写熔断降级类" class="headerlink" title="6.2.2.2 编写熔断降级类"></a>6.2.2.2 编写熔断降级类</h4><p><img src="http://mele.cool//image-20200920221259559.png" alt="image-20200920221259559"></p>
<h4 id="6-2-2-3-feign客户端指定使用降级类"><a href="#6-2-2-3-feign客户端指定使用降级类" class="headerlink" title="6.2.2.3  feign客户端指定使用降级类"></a>6.2.2.3  feign客户端指定使用降级类</h4><p><img src="http://mele.cool//image-20200920221348726.png" alt="image-20200920221348726"></p>
<h3 id="6-2-3-请求压缩"><a href="#6-2-3-请求压缩" class="headerlink" title="6.2.3 请求压缩"></a>6.2.3 请求压缩</h3><h3 id="6-2-4-日志级别"><a href="#6-2-4-日志级别" class="headerlink" title="6.2.4 日志级别"></a>6.2.4 日志级别</h3><h1 id="7-Gateway-网关"><a href="#7-Gateway-网关" class="headerlink" title="7.Gateway 网关"></a>7.Gateway 网关</h1><p><img src="http://mele.cool//image-20200923211651489.png" alt="image-20200923211651489"></p>
<p><img src="http://mele.cool//image-20200923211754242.png" alt="image-20200923211754242"></p>
<p><strong>核心概念:</strong></p>
<p><img src="http://mele.cool//image-20200923211925717.png" alt="image-20200923211925717"></p>
<p><img src="http://mele.cool//image-20200923212140202.png" alt="image-20200923212140202"></p>
<h2 id="7-1-入门工程"><a href="#7-1-入门工程" class="headerlink" title="7.1 入门工程"></a>7.1 入门工程</h2><h3 id="7-1-1-依赖"><a href="#7-1-1-依赖" class="headerlink" title="7.1.1 依赖"></a>7.1.1 依赖</h3><p><img src="http://mele.cool//image-20200923212228237.png" alt="image-20200923212228237"></p>
<h3 id="7-1-2-启动类"><a href="#7-1-2-启动类" class="headerlink" title="7.1.2 启动类"></a>7.1.2 启动类</h3><p> <img src="http://mele.cool//image-20200923212323963.png" alt="image-20200923212323963"></p>
<h3 id="7-1-3-配置文件"><a href="#7-1-3-配置文件" class="headerlink" title="7.1.3 配置文件"></a>7.1.3 配置文件</h3><p><img src="http://mele.cool//image-20200923212655857.png" alt="image-20200923212655857"></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:10010/user/8">http://127.0.0.1:10010/user/8</a> -&gt; <a target="_blank" rel="noopener" href="http://127.0.0.1:9091/user/8">http://127.0.0.1:9091/user/8</a></p>
</blockquote>
<h3 id="7-1-4-测试"><a href="#7-1-4-测试" class="headerlink" title="7.1.4 测试"></a>7.1.4 测试</h3><p><img src="http://mele.cool//image-20200923212902804.png" alt="image-20200923212902804"></p>
<h2 id="7-2-面向服务的路由-动态路由"><a href="#7-2-面向服务的路由-动态路由" class="headerlink" title="7.2 面向服务的路由(动态路由)"></a>7.2 面向服务的路由(动态路由)</h2><p><img src="http://mele.cool//image-20200923213930806.png" alt="image-20200923213930806"></p>
<p><img src="http://mele.cool//image-20200923213911706.png" alt="image-20200923213911706"></p>
<h2 id="7-3-路由前缀处理"><a href="#7-3-路由前缀处理" class="headerlink" title="7.3 路由前缀处理"></a>7.3 路由前缀处理</h2><p><img src="http://mele.cool//image-20200923214142011.png" alt="image-20200923214142011"></p>
<h4 id="7-3-1-添加前缀"><a href="#7-3-1-添加前缀" class="headerlink" title="7.3.1 添加前缀"></a>7.3.1 添加前缀</h4><p><img src="http://mele.cool//image-20200923214503568.png" alt="image-20200923214503568"></p>
<p><img src="http://mele.cool//image-20200923214600258.png" alt="image-20200923214600258"></p>
<h3 id="7-3-2-去除前缀"><a href="#7-3-2-去除前缀" class="headerlink" title="7.3.2 去除前缀"></a>7.3.2 去除前缀</h3><p><img src="http://mele.cool//image-20200923214822024.png" alt="image-20200923214822024"></p>
<p><img src="http://mele.cool//image-20200923214910646.png" alt="image-20200923214910646"></p>
<h2 id="7-4-过滤器"><a href="#7-4-过滤器" class="headerlink" title="7.4 过滤器"></a>7.4 过滤器</h2><p><img src="http://mele.cool//image-20200923215013929.png" alt="image-20200923215013929"></p>
<p> <img src="http://mele.cool//image-20200923215301331.png" alt="image-20200923215301331"></p>
<p><img src="http://mele.cool//image-20200923215334116.png" alt="image-20200923215334116"></p>
<p><img src="http://mele.cool//image-20200923215428236.png" alt="image-20200923215428236"></p>
<p><img src="http://mele.cool//image-20200923215516964.png" alt="image-20200923215516964"></p>
<p><img src="http://mele.cool//image-20200923215547317.png" alt="image-20200923215547317"></p>
<p><img src="http://mele.cool//image-20200923215701949.png" alt="image-20200923215701949"></p>
<h2 id="7-5-自定义过滤器"><a href="#7-5-自定义过滤器" class="headerlink" title="7.5 自定义过滤器"></a>7.5 自定义过滤器</h2><h3 id="7-5-1-自定义局部过滤器"><a href="#7-5-1-自定义局部过滤器" class="headerlink" title="7.5.1 自定义局部过滤器"></a>7.5.1 自定义局部过滤器</h3><blockquote>
<p>需求:在过滤器( MyParamGatewayFilterFactory )中将<a target="_blank" rel="noopener" href="http://localhost:10010/api/user/8?name=itcast%E4%B8%AD%E7%9A%84%E5%8F%82%E6%95%B0name%E7%9A%84%E5%80%BC%E8%8E%B7%E5%8F%96%E5%88%B0%E5%B9%B6%E8%BE%93%E5%87%BA%E5%88%B0%E6%8E%A7%E5%88%B6%E5%8F%B0;%E5%B9%B6%E4%B8%94%E5%8F%82%E6%95%B0%E5%90%8D%E6%98%AF%E5%8F%AF%E5%8F%98%E7%9A%84,%E4%B9%9F%E5%B0%B1%E6%98%AF%E4%B8%8D%E4%B8%80%E5%AE%9A%E6%AF%8F%E6%AC%A1%E9%83%BD%E6%98%AFname">http://localhost:10010/api/user/8?name=itcast中的参数name的值获取到并输出到控制台;并且参数名是可变的,也就是不一定每次都是name</a> ;需要可以通过配置过滤器的时候做到配置参数名。</p>
</blockquote>
<h4 id="7-5-1-1-配置"><a href="#7-5-1-1-配置" class="headerlink" title="7.5.1.1 配置"></a>7.5.1.1 配置</h4><p><img src="http://mele.cool//image-20200923220045239.png" alt="image-20200923220045239"></p>
<h4 id="7-5-1-2-编写过滤器类"><a href="#7-5-1-2-编写过滤器类" class="headerlink" title="7.5.1.2 编写过滤器类"></a>7.5.1.2 编写过滤器类</h4><p><img src="http://mele.cool//image-20200923220916297.png" alt="image-20200923220916297"></p>
<h4 id="7-5-1-3-测试"><a href="#7-5-1-3-测试" class="headerlink" title="7.5.1.3 测试"></a>7.5.1.3 测试</h4><p><img src="http://mele.cool//image-20200923221005101.png" alt="image-20200923221005101"><img src="http://mele.cool//image-20200923221026836.png" alt="image-20200923221026836"></p>
<h3 id="7-5-2-自定义全局过滤器"><a href="#7-5-2-自定义全局过滤器" class="headerlink" title="7.5.2 自定义全局过滤器"></a>7.5.2 自定义全局过滤器</h3><blockquote>
<p>需求:编写全局过滤器,在过滤器中检查请求地址是否携带token参数。如果token参数的值存在则放行;如果token的参数值为空或者不存在则设置返回的状态码为:未授权也不再执行下去</p>
</blockquote>
<h4 id="7-5-2-1-编写全局过滤器"><a href="#7-5-2-1-编写全局过滤器" class="headerlink" title="7.5.2.1 编写全局过滤器"></a>7.5.2.1 编写全局过滤器</h4><p><img src="http://mele.cool//image-20200923221443289.png" alt="image-20200923221443289"></p>
<h4 id="7-5-2-2-测试"><a href="#7-5-2-2-测试" class="headerlink" title="7.5.2.2 测试"></a>7.5.2.2 测试</h4><p> <img src="http://mele.cool//image-20200923221716106.png" alt="image-20200923221716106"><img src="http://mele.cool//image-20200923221740245.png" alt="image-20200923221740245"></p>
<h2 id="7-6-gateway其他配置"><a href="#7-6-gateway其他配置" class="headerlink" title="7.6 gateway其他配置"></a>7.6 gateway其他配置</h2><p><img src="http://mele.cool//image-20200923221838328.png" alt="image-20200923221838328"><img src="http://mele.cool//image-20200923221937995.png" alt="image-20200923221937995"><img src="http://mele.cool//image-20200923222035564.png" alt="image-20200923222035564"><img src="http://mele.cool//image-20200923222243751.png" alt="image-20200923222243751"><img src="http://mele.cool//image-20200923222311843.png" alt="image-20200923222311843"></p>
<h1 id="8-springcloud-config-配置中心"><a href="#8-springcloud-config-配置中心" class="headerlink" title="8.springcloud config 配置中心"></a>8.springcloud config 配置中心</h1><blockquote>
<p>spring cloud config作用:可以通过修改在git仓库中的配置文件实现其它所有微服务的配置文件的修改。</p>
</blockquote>
<p><img src="http://mele.cool//image-20200923222455968.png" alt="image-20200923222455968"><img src="http://mele.cool//image-20200923222521176.png" alt="image-20200923222521176"></p>
<h2 id="8-1-搭建配置中心微服务"><a href="#8-1-搭建配置中心微服务" class="headerlink" title="8.1 搭建配置中心微服务"></a>8.1 搭建配置中心微服务</h2><h3 id="8-1-1-依赖"><a href="#8-1-1-依赖" class="headerlink" title="8.1.1 依赖"></a>8.1.1 依赖</h3><p><img src="http://mele.cool//image-20200923223034987.png" alt="image-20200923223034987"></p>
<h3 id="8-1-2-启动类"><a href="#8-1-2-启动类" class="headerlink" title="8.1.2 启动类"></a>8.1.2 启动类</h3><p><img src="http://mele.cool//image-20200923223109585.png" alt="image-20200923223109585"></p>
<h3 id="8-1-3-配置文件"><a href="#8-1-3-配置文件" class="headerlink" title="8.1.3 配置文件"></a>8.1.3 配置文件</h3><p><img src="http://mele.cool//image-20200923223203360.png" alt="image-20200923223203360"></p>
<h3 id="8-1-4-测试"><a href="#8-1-4-测试" class="headerlink" title="8.1.4 测试"></a>8.1.4 测试</h3><blockquote>
<p>在gitee中修改了配置文件会在配置中心服务及时更新。</p>
</blockquote>
<p><img src="http://mele.cool//image-20200923223301672.png" alt="image-20200923223301672"></p>
<h2 id="8-2-获取配置中心配置"><a href="#8-2-获取配置中心配置" class="headerlink" title="8.2  获取配置中心配置"></a>8.2  获取配置中心配置</h2><p><img src="http://mele.cool//image-20200923223953961.png" alt="image-20200923223953961"></p>
<blockquote>
<p> <strong>目标</strong>:改造用户微服务user-service ,配置文件信息不再由微服务项目提供,而是从配置中心获取<br> <strong>需求</strong>:将服务提供工程user-service的application.yml配置文件删除,修改为从配置中心config-server中获取。<br> <strong>实现步骤:</strong><br>     1.添加启动器依赖;<br>     2.修改配置文件;<br>     3.启动测试</p>
</blockquote>
<h3 id="8-2-1-依赖"><a href="#8-2-1-依赖" class="headerlink" title="8.2.1 依赖"></a>8.2.1 依赖</h3><p><img src="http://mele.cool//image-20200923223751935.png" alt="image-20200923223751935"></p>
<h3 id="8-2-2-删除原来配置文件application-propetes-创建bootstrap-yml"><a href="#8-2-2-删除原来配置文件application-propetes-创建bootstrap-yml" class="headerlink" title="8.2.2 删除原来配置文件application.propetes,创建bootstrap.yml"></a>8.2.2 删除原来配置文件application.propetes,创建bootstrap.yml</h3><blockquote>
<p>将原来的application.yml删除;然后添加bootstrap.yml配置文件,该文件也是spring boot的默认配置文件,其内容经常配置一些项目中固定的配置项。如果是项目经常变动的应该配置到application.yml中,现在使用了配置中心则应该配置到git仓库中对于的配置文件。</p>
</blockquote>
<p><img src="http://mele.cool//image-20200923224222475.png" alt="image-20200923224222475"></p>
<h3 id="8-2-3-测试成功"><a href="#8-2-3-测试成功" class="headerlink" title="8.2.3 测试成功"></a>8.2.3 测试成功</h3><p><img src="http://mele.cool//image-20200923224328755.png" alt="image-20200923224328755"></p>
<h1 id="9-springcloud-bus消息总线"><a href="#9-springcloud-bus消息总线" class="headerlink" title="9.springcloud bus消息总线"></a>9.springcloud bus消息总线</h1><blockquote>
<p>Spring Cloud Bus是用轻量的消息代理将分布式的节点连接起来,可以用于广播配置文件的更改或者服务的监控管理。也就是消息总线可以为微服务做监控,也可以实现应用程序之间相互通信。 Spring Cloud Bus可选的消息 理有RabbitMQ和Kafka</p>
<p><strong>Spring Cloud Bus作用:将git仓库的配置文件更新,在不重启系统的情况下实现及时同步到各个微服务。</strong></p>
</blockquote>
<p><img src="http://mele.cool//image-20200923225605902.png" alt="image-20200923225605902"></p>
<p><strong>目标</strong>:启动RabbitMQ通过修改码云中的配置文件后发送Post请求实现及时更新用户微服务中的配置项分析<br><strong>需求:**在码云的git仓库中修改user-dev.yml配置文件,实现不重启user-service的情况下可以及时更新配置文件。<br>**实现步骤:</strong></p>
<ol>
<li>启动RabbitMQ;</li>
<li>修改配置中心config-server;</li>
<li>修改服务提供工程dser-service ;</li>
<li>测试</li>
</ol>
<h2 id="9-1改造配置中心"><a href="#9-1改造配置中心" class="headerlink" title="9.1改造配置中心"></a>9.1改造配置中心</h2><h3 id="9-1-1-在config-server项目的pom-xml文件中加入Spring-Cloud-Bus相关依赖"><a href="#9-1-1-在config-server项目的pom-xml文件中加入Spring-Cloud-Bus相关依赖" class="headerlink" title="9.1.1 在config-server项目的pom.xml文件中加入Spring Cloud Bus相关依赖"></a>9.1.1 在config-server项目的pom.xml文件中加入Spring Cloud Bus相关依赖</h3><p><img src="http://mele.cool//image-20200923225337626.png" alt="image-20200923225337626"></p>
<h3 id="9-1-2-修改配置文件"><a href="#9-1-2-修改配置文件" class="headerlink" title="9.1.2 修改配置文件"></a>9.1.2 修改配置文件</h3><p><img src="http://mele.cool//image-20200923225648167.png" alt="image-20200923225648167"></p>
<h2 id="9-3-修改服务提供工程"><a href="#9-3-修改服务提供工程" class="headerlink" title="9.3 修改服务提供工程"></a>9.3 修改服务提供工程</h2><h3 id="9-3-1-添加依赖"><a href="#9-3-1-添加依赖" class="headerlink" title="9.3.1 添加依赖"></a>9.3.1 添加依赖</h3><p><img src="http://mele.cool//image-20200923225758719.png" alt="image-20200923225758719"></p>
<h3 id="9-3-2-配置文件"><a href="#9-3-2-配置文件" class="headerlink" title="9.3.2 配置文件"></a>9.3.2 配置文件</h3><p><img src="http://mele.cool//image-20200923225903422.png" alt="image-20200923225903422"></p>
<h3 id="9-3-3-修改控制器"><a href="#9-3-3-修改控制器" class="headerlink" title="9.3.3 修改控制器"></a>9.3.3 修改控制器</h3><p><img src="http://mele.cool//image-20200923225950867.png" alt="image-20200923225950867"></p>
<h3 id="9-3-4-测试"><a href="#9-3-4-测试" class="headerlink" title="9.3.4 测试"></a>9.3.4 测试</h3><p>git上修改完配置文件后,需要手动访问下配置中心的这个路径,才会发消息给服务获取最新配置项:</p>
<p><img src="http://mele.cool//image-20200923230359915.png" alt="image-20200923230359915"></p>
<p><img src="http://mele.cool//image-20200923230312058.png" alt="image-20200923230312058"></p>
<h1 id="10-springCloud综合应用"><a href="#10-springCloud综合应用" class="headerlink" title="10. springCloud综合应用"></a>10. springCloud综合应用</h1><p><img src="http://mele.cool//image-20200923230549118.png" alt="image-20200923230549118"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/04/springcloud%E5%85%A5%E9%97%A8(1)/" data-id="ckke5nr59009ocl8gcelyfwau" data-title="springCloud入门" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/springCloud/" rel="tag">springCloud</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%85%A5%E9%97%A8/" rel="tag">入门</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-分布式框架面试题合集" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/04/%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6%E9%9D%A2%E8%AF%95%E9%A2%98%E5%90%88%E9%9B%86/" class="article-date">
  <time class="dt-published" datetime="2020-12-04T02:10:17.000Z" itemprop="datePublished">2020-12-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/04/%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6%E9%9D%A2%E8%AF%95%E9%A2%98%E5%90%88%E9%9B%86/">Java 分布式框架面试题合集</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="1-什么是-ZooKeeper？"><a href="#1-什么是-ZooKeeper？" class="headerlink" title="1.什么是 ZooKeeper？"></a>1.什么是 ZooKeeper？</h4><p>答：ZooKeeper 是一个开源的分布式应用程序协调服务，是一个典型的分布式数据一致性解决方案。设计目的是将那些复杂且容易出错的分布式一致性服务封装起来，构成一个高效可靠的系统，并以一系列简单易用的原子操作提供给用户使用。</p>
<h4 id="2-ZooKeeper-提供了哪些功能？"><a href="#2-ZooKeeper-提供了哪些功能？" class="headerlink" title="2.ZooKeeper 提供了哪些功能？"></a>2.ZooKeeper 提供了哪些功能？</h4><p>答：ZooKeeper 主要提供以下功能：</p>
<ul>
<li>分布式服务注册与订阅：在分布式环境中，为了保证高可用性，通常同一个应用或同一个服务的提供方都会部署多份，达到对等服务。而消费者就须要在这些对等的服务器中选择一个来执行相关的业务逻辑，比较典型的服务注册与订阅，如 Dubbo。</li>
<li>分布式配置中心：发布与订阅模型，即所谓的配置中心，顾名思义就是发布者将数据发布到 ZooKeeper 节点上，供订阅者获取数据，实现配置信息的集中式管理和动态更新。</li>
<li>命名服务：在分布式系统中，通过命名服务客户端应用能够根据指定名字来获取资源、服务地址和提供者等信息。</li>
<li>分布式锁：这个主要得益于 ZooKeeper 为我们保证了数据的强一致性。</li>
</ul>
<h4 id="3-ZooKeeper-有几种搭建模式？"><a href="#3-ZooKeeper-有几种搭建模式？" class="headerlink" title="3.ZooKeeper 有几种搭建模式？"></a>3.ZooKeeper 有几种搭建模式？</h4><p>答：ZooKeeper 通常有三种搭建模式：</p>
<ul>
<li>单机模式：zoo.cfg 中只配置一个 server.id 就是单机模式了，此模式一般用在测试环境，如果当前主机宕机，那么所有依赖于当前 ZooKeeper 服务工作的其他服务器都不能进行正常工作；</li>
<li>伪分布式模式：在一台机器启动不同端口的 ZooKeeper，配置到 zoo.cfg 中，和单机模式相同，此模式一般用在测试环境；</li>
<li>分布式模式：多台机器各自配置 zoo.cfg 文件，将各自互相加入服务器列表，上面搭建的集群就是这种完全分布式。</li>
</ul>
<h4 id="4-ZooKeeper-有哪些特性？"><a href="#4-ZooKeeper-有哪些特性？" class="headerlink" title="4.ZooKeeper 有哪些特性？"></a>4.ZooKeeper 有哪些特性？</h4><p>答： ZooKeeper 特性如下：</p>
<ul>
<li>顺序一致性（Sequential Consistency）：来自相同客户端提交的事务，ZooKeeper 将严格按照其提交顺序依次执行；</li>
<li>原子性（Atomicity）：于 ZooKeeper 集群中提交事务，事务将“全部完成”或“全部未完成”，不存在“部分完成”；</li>
<li>单一系统镜像（Single System Image）：客户端连接到 ZooKeeper 集群的任意节点，其获得的数据视图都是相同的；</li>
<li>可靠性（Reliability）：事务一旦完成，其产生的状态变化将永久保留，直到其他事务进行覆盖；</li>
<li>实时性（Timeliness）：事务一旦完成，客户端将于限定的时间段内，获得最新的数据。</li>
</ul>
<h4 id="5-以下关于-ZooKeeper-描述错误的是？"><a href="#5-以下关于-ZooKeeper-描述错误的是？" class="headerlink" title="5.以下关于 ZooKeeper 描述错误的是？"></a>5.以下关于 ZooKeeper 描述错误的是？</h4><p>A：所有的节点都具有稳定的存储能力 B：ZooKeeper 任意节点之间都能够进行通信（消息发送 &amp; 接收） C：为了提高性能，ZooKeeper 允许同一份数据存在一部分节点写成功，另一部分节点写失败 D：ZooKeeper 集群运行期间，只要半数以上节点存活，ZooKeeper 就能正常服务 答：C 题目解析：ZooKeeper 不允许同一份数据存在一部分节点写成功，另一部分节点写失败的情况，这不符合 ZooKeeper“一致性”的原则。</p>
<h4 id="6-ZooKeeper-如何实现分布式锁？"><a href="#6-ZooKeeper-如何实现分布式锁？" class="headerlink" title="6.ZooKeeper 如何实现分布式锁？"></a>6.ZooKeeper 如何实现分布式锁？</h4><p>答：ZooKeeper 实现分布式锁的步骤如下：</p>
<ul>
<li>客户端连接 ZooKeeper，并在 /lock 下创建临时的且有序的子节点，第一个客户端对应的子节点为 /lock/lock-10000000001，第二个为 /lock/lock-10000000002，以此类推。</li>
<li>客户端获取 /lock 下的子节点列表，判断自己创建的子节点是否为当前子节点列表中序号最小的子节点，如果是则认为获得锁，否则监听刚好在自己之前一位的子节点删除消息，获得子节点变更通知后重复此步骤直至获得锁；</li>
<li>执行业务代码；</li>
<li>完成业务流程后，删除对应的子节点释放锁。</li>
</ul>
<p>整体流程如下图所示：</p>
<p><img src="https://images.gitbook.cn/a7143b40-db48-11e9-9f9d-c526a5f387ab" alt="1"></p>
<h4 id="7-ZooKeeper-如何实现分布式事务？"><a href="#7-ZooKeeper-如何实现分布式事务？" class="headerlink" title="7.ZooKeeper 如何实现分布式事务？"></a>7.ZooKeeper 如何实现分布式事务？</h4><p>答：ZooKeeper 实现分布式事务，类似于两阶段提交，总共分为以下 4 步：</p>
<ul>
<li>客户端先给 ZooKeeper 节点发送写请求；</li>
<li>ZooKeeper 节点将写请求转发给 Leader 节点，Leader 广播给集群要求投票，等待确认；</li>
<li>Leader 收到确认，统计投票，票数过半则提交事务；</li>
<li>事务提交成功后，ZooKeeper 节点告知客户端。</li>
</ul>
<h4 id="8-集群中为什么要有主节点？"><a href="#8-集群中为什么要有主节点？" class="headerlink" title="8.集群中为什么要有主节点？"></a>8.集群中为什么要有主节点？</h4><p>答：在分布式环境中，有些业务逻辑只需要集群中的某一台机器进行执行，其他的机器可以共享这个结果，这样可以大大减少重复计算，提高性能，这就是主节点存在的意义。</p>
<h4 id="9-Dubbo-是什么？"><a href="#9-Dubbo-是什么？" class="headerlink" title="9.Dubbo 是什么？"></a>9.Dubbo 是什么？</h4><p>答：Dubbo 是一款高性能、轻量级的开源 Java RPC 框架，它提供了三大核心能力：面向接口的远程方法调用，智能容错和负载均衡，以及服务自动注册和发现。</p>
<h4 id="10-Dubbo-有哪些特性？"><a href="#10-Dubbo-有哪些特性？" class="headerlink" title="10.Dubbo 有哪些特性？"></a>10.Dubbo 有哪些特性？</h4><p>答：Dubbo 特性如下：</p>
<ul>
<li>面向接口代理的高性能 RPC 调用：提供高性能的基于代理的远程调用能力，服务以接口为粒度，为开发者屏蔽远程调用底层细节；</li>
<li>智能负载均衡：内置多种负载均衡策略，智能感知下游节点健康状况，显著减少调用延迟，提高系统吞吐量；</li>
<li>服务自动注册与发现：支持多种注册中心服务，服务实例上下线实时感知；</li>
<li>高度可扩展能力：遵循微内核+插件的设计原则，所有核心能力如 Protocol、Transport、Serialization 被设计为扩展点，平等对待内置实现和第三方实现；</li>
<li>运行期流量调度：内置条件、脚本等路由策略，通过配置不同的路由规则，轻松实现灰度发布，同机房优先等功能；</li>
<li>可视化的服务治理与运维：提供丰富服务治理、运维工具：随时查询服务元数据、服务健康状态及调用统计，实时下发路由策略、调整配置参数。</li>
</ul>
<h4 id="11-Dubbo-有哪些核心组件？"><a href="#11-Dubbo-有哪些核心组件？" class="headerlink" title="11.Dubbo 有哪些核心组件？"></a>11.Dubbo 有哪些核心组件？</h4><p>答：Dubbo 核心组件如下：</p>
<ul>
<li>Provider：服务提供方</li>
<li>Consumer：服务消费方</li>
<li>Registry：服务注册与发现的注册中心</li>
<li>Monitor：主要用来统计服务的调用次数和调用时间</li>
<li>Container：服务的运行容器</li>
</ul>
<h4 id="12-Dubbo-有哪些负载均衡策略？"><a href="#12-Dubbo-有哪些负载均衡策略？" class="headerlink" title="12.Dubbo 有哪些负载均衡策略？"></a>12.Dubbo 有哪些负载均衡策略？</h4><p>答：Dubbo 负责均衡策略如下：</p>
<ul>
<li>随机负载均衡（Random LoadBalance）：按权重设置随机概率，在一个截面上碰撞的概率高，但调用量越大分布越均匀，而且按概率使用权重后也比较均匀，有利于动态调整提供者权重；</li>
<li>轮询负载均衡（RoundRobin LoadBalance）：按公约后的权重设置轮询比率，存在慢的提供者累积请求的问题，比如：第二台机器很慢，但没挂，当请求调到第二台时就卡在那，久而久之，所有请求都卡在调到第二台上；</li>
<li>最少活跃调用数负载均衡（LeastActive LoadBalance）：使用最少活跃调用数，活跃数指调用前后计数差；</li>
<li>哈希负载均衡（ConsistentHash LoadBalance）：使用哈希值转发，相同参数的请求总是发到同一提供者。</li>
</ul>
<p><strong>负载均衡配置如下</strong>：</p>
<p>服务端服务级别</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">&quot;xxx&quot;</span> <span class="attr">loadbalance</span>=<span class="string">&quot;roundrobin&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>客户端服务级别</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">interface</span>=<span class="string">&quot;xxx&quot;</span> <span class="attr">loadbalance</span>=<span class="string">&quot;roundrobin&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>服务端方法级别</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">&quot;xxx&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">&quot;xxx&quot;</span> <span class="attr">loadbalance</span>=<span class="string">&quot;roundrobin&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dubbo:service</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>客户端方法级别</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">interface</span>=<span class="string">&quot;xxx&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">&quot;xxx&quot;</span> <span class="attr">loadbalance</span>=<span class="string">&quot;roundrobin&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dubbo:reference</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="13-Dubbo-不支持以下哪种协议？"><a href="#13-Dubbo-不支持以下哪种协议？" class="headerlink" title="13.Dubbo 不支持以下哪种协议？"></a>13.Dubbo 不支持以下哪种协议？</h4><p>A：dubbo://<br>B：rmi://<br>C：redis://<br>D：restful://</p>
<p>答：D</p>
<p>题目解析：restful 是一种编程规范，并不是一种传输协议，也不被 Dubbo 支持。</p>
<h4 id="14-Dubbo-默认使用什么注册中心，还有别的选择吗？"><a href="#14-Dubbo-默认使用什么注册中心，还有别的选择吗？" class="headerlink" title="14.Dubbo 默认使用什么注册中心，还有别的选择吗？"></a>14.Dubbo 默认使用什么注册中心，还有别的选择吗？</h4><p>答：推荐使用 ZooKeeper 作为注册中心，还有 Nacos、Redis、Simple 注册中心（普通的 Dubbo 服务）。</p>
<h4 id="15-Dubbo-支持多注册中心吗？"><a href="#15-Dubbo-支持多注册中心吗？" class="headerlink" title="15.Dubbo 支持多注册中心吗？"></a>15.Dubbo 支持多注册中心吗？</h4><p>答：Dubbo 支持同一服务向多注册中心同时注册，或者不同服务分别注册到不同的注册中心上去，甚至可以同时引用注册在不同注册中心上的同名服务。</p>
<p>多注册中心注册：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://dubbo.apache.org/schema/dubbo&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">&quot;world&quot;</span>  /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 多注册中心配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">id</span>=<span class="string">&quot;hangzhouRegistry&quot;</span> <span class="attr">address</span>=<span class="string">&quot;10.20.141.150:9090&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">id</span>=<span class="string">&quot;qingdaoRegistry&quot;</span> <span class="attr">address</span>=<span class="string">&quot;10.20.141.151:9010&quot;</span> <span class="attr">default</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 向多个注册中心注册 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">&quot;com.alibaba.hello.api.HelloService&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.0.0&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;helloService&quot;</span> <span class="attr">registry</span>=<span class="string">&quot;hangzhouRegistry,qingdaoRegistry&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="16-Dubbo-支持的连接方式有哪些？"><a href="#16-Dubbo-支持的连接方式有哪些？" class="headerlink" title="16.Dubbo 支持的连接方式有哪些？"></a>16.Dubbo 支持的连接方式有哪些？</h4><p>答：Dubbo 支持的主要连接方式有：组播、直连和 ZooKeeper 等注册中心。</p>
<p><strong>① 组播方式</strong>，不需要启动任何中心节点，只要广播地址一样，就可以互相发现。</p>
<p><img src="https://images.gitbook.cn/e3086fe0-db48-11e9-9f9d-c526a5f387ab" alt="2"></p>
<ol>
<li>提供方启动时广播自己的地址</li>
<li>消费方启动时广播订阅请求</li>
<li>提供方收到订阅请求时，单播自己的地址给订阅者，如果设置了 unicast=false，则广播给订阅者</li>
<li>消费方收到提供方地址时，连接该地址进行 RPC 调用</li>
</ol>
<p>组播受网络结构限制，只适合小规模应用或开发阶段使用。组播地址段：224.0.0.0 ~ 239.255.255.255</p>
<p>配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:registry address&#x3D;&quot;multicast:&#x2F;&#x2F;224.5.6.7:1234&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:registry protocol&#x3D;&quot;multicast&quot; address&#x3D;&quot;224.5.6.7:1234&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>为了减少广播量，Dubbo 缺省使用单播发送提供者地址信息给消费者，如果一个机器上同时启了多个消费者进程，消费者需声明 unicast=false，否则只会有一个消费者能收到消息；当服务者和消费者运行在同一台机器上，消费者同样需要声明 unicast=false，否则消费者无法收到消息，导致 No provider available for the service 异常：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:registry address&#x3D;&quot;multicast:&#x2F;&#x2F;224.5.6.7:1234?unicast&#x3D;false&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:registry protocol&#x3D;&quot;multicast&quot; address&#x3D;&quot;224.5.6.7:1234&quot;&gt;</span><br><span class="line">    &lt;dubbo:parameter key&#x3D;&quot;unicast&quot; value&#x3D;&quot;false&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;dubbo:registry&gt;</span><br></pre></td></tr></table></figure>
<p><strong>② 直连方式</strong>，注册中心本身就是一个普通的 Dubbo 服务，可以减少第三方依赖，使整体通讯方式一致。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">protocol</span>=<span class="string">&quot;zookeeper&quot;</span> <span class="attr">address</span>=<span class="string">&quot;N/A&quot;</span>  <span class="attr">file</span>=<span class="string">&quot;./.dubbo-platform&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>将 Simple 注册中心暴露成 Dubbo 服务：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&quot;</span><br><span class="line">    xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">    xmlns:dubbo&#x3D;&quot;http:&#x2F;&#x2F;dubbo.apache.org&#x2F;schema&#x2F;dubbo&quot;</span><br><span class="line">    xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&#x2F;spring-beans-4.3.xsd http:&#x2F;&#x2F;dubbo.apache.org&#x2F;schema&#x2F;dubbo http:&#x2F;&#x2F;dubbo.apache.org&#x2F;schema&#x2F;dubbo&#x2F;dubbo.xsd&quot;&gt;</span><br><span class="line">    &lt;!-- 当前应用信息配置 --&gt;</span><br><span class="line">    &lt;dubbo:application name&#x3D;&quot;simple-registry&quot; &#x2F;&gt;</span><br><span class="line">    &lt;!-- 暴露服务协议配置 --&gt;</span><br><span class="line">    &lt;dubbo:protocol port&#x3D;&quot;9090&quot; &#x2F;&gt;</span><br><span class="line">    &lt;!-- 暴露服务配置 --&gt;</span><br><span class="line">    &lt;dubbo:service interface&#x3D;&quot;org.apache.dubbo.registry.RegistryService&quot; ref&#x3D;&quot;registryService&quot; registry&#x3D;&quot;N&#x2F;A&quot; ondisconnect&#x3D;&quot;disconnect&quot; callbacks&#x3D;&quot;1000&quot;&gt;</span><br><span class="line">        &lt;dubbo:method name&#x3D;&quot;subscribe&quot;&gt;&lt;dubbo:argument index&#x3D;&quot;1&quot; callback&#x3D;&quot;true&quot; &#x2F;&gt;&lt;&#x2F;dubbo:method&gt;</span><br><span class="line">        &lt;dubbo:method name&#x3D;&quot;unsubscribe&quot;&gt;&lt;dubbo:argument index&#x3D;&quot;1&quot; callback&#x3D;&quot;false&quot; &#x2F;&gt;&lt;&#x2F;dubbo:method&gt;</span><br><span class="line">    &lt;&#x2F;dubbo:service&gt;</span><br><span class="line">    &lt;!-- 简单注册中心实现，可自行扩展实现集群和状态同步 --&gt;</span><br><span class="line">    &lt;bean id&#x3D;&quot;registryService&quot; class&#x3D;&quot;org.apache.dubbo.registry.simple.SimpleRegistryService&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;beans&gt;</span><br></pre></td></tr></table></figure>
<p>引用 Simple Registry 服务：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:registry address&#x3D;&quot;127.0.0.1:9090&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>或者：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:service interface&#x3D;&quot;org.apache.dubbo.registry.RegistryService&quot; group&#x3D;&quot;simple&quot; version&#x3D;&quot;1.0.0&quot; ... &gt;</span><br></pre></td></tr></table></figure>
<p>或者：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:registry address&#x3D;&quot;127.0.0.1:9090&quot; group&#x3D;&quot;simple&quot; version&#x3D;&quot;1.0.0&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>适用性说明：此 SimpleRegistryService 只是简单实现，不支持集群，可作为自定义注册中心的参考，但不适合直接用于生产环境。</p>
<p><strong>③ ZooKeeper 注册中心</strong>，Zookeeper 是 Apacahe Hadoop 的子项目，是一个树型的目录服务，支持变更推送，适合作为 Dubbo 服务的注册中心，工业强度较高，可用于生产环境，并推荐使用。</p>
<p><img src="https://images.gitbook.cn/1c638310-db49-11e9-b7e8-efbebe7dfdf6" alt="3"></p>
<p>流程说明：</p>
<ul>
<li>服务提供者启动时：向 /dubbo/com.foo.BarService/providers 目录下写入自己的 URL 地址</li>
<li>服务消费者启动时：订阅 /dubbo/com.foo.BarService/providers 目录下的提供者 URL 地址，并向 /dubbo/com.foo.BarService/consumers 目录下写入自己的 URL 地址</li>
<li>监控中心启动时: 订阅 /dubbo/com.foo.BarService 目录下的所有提供者和消费者 URL 地址</li>
</ul>
<p>支持以下功能：</p>
<ul>
<li>当提供者出现断电等异常停机时，注册中心能自动删除提供者信息</li>
<li>当注册中心重启时，能自动恢复注册数据，以及订阅请求</li>
<li>当会话过期时，能自动恢复注册数据，以及订阅请求</li>
<li>当设置 `` 时，记录失败注册和订阅请求，后台定时重试</li>
<li>可通过 `` 设置 zookeeper 登录信息</li>
<li>可通过 `` 设置 zookeeper 的根节点，不设置将使用无根树</li>
<li>支持 <code>*</code> 号通配符 ``，可订阅服务的所有分组和所有版本的提供者</li>
</ul>
<p><strong>Zookeeper 使用</strong></p>
<p>在 provider 和 consumer 中增加 zookeeper 客户端 jar 包依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.zookeeper&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;zookeeper&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.3.3&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>
<p>Dubbo 支持 zkclient 和 curator 两种 Zookeeper 客户端实现：</p>
<blockquote>
<p>注意：在 2.7.x 的版本中已经移除了 zkclient 的实现，如果要使用 zkclient 客户端，需要自行拓展。</p>
</blockquote>
<p><strong>使用 zkclient 客户端</strong></p>
<p>从 2.2.0 版本开始缺省为 zkclient 实现，以提升 zookeeper 客户端的健状性。<a target="_blank" rel="noopener" href="https://github.com/sgroschupf/zkclient">zkclient</a> 是 Datameer 开源的一个 Zookeeper 客户端实现。</p>
<p>缺省配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:registry ... client&#x3D;&quot;zkclient&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>或：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dubbo.registry.client&#x3D;zkclient</span><br></pre></td></tr></table></figure>
<p>或：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zookeeper:&#x2F;&#x2F;10.20.153.10:2181?client&#x3D;zkclient</span><br></pre></td></tr></table></figure>
<p>需依赖或直接<a target="_blank" rel="noopener" href="http://repo1.maven.org/maven2/com/github/sgroschupf/zkclient">下载</a>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.github.sgroschupf&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;zkclient&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.1&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>
<p><strong>使用 curator 客户端</strong></p>
<p>从 2.3.0 版本开始支持可选 curator 实现。Curator 是 Netflix 开源的一个 Zookeeper 客户端实现。</p>
<p>如果需要改为 curator 实现，请配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:registry ... client&#x3D;&quot;curator&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>或：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dubbo.registry.client&#x3D;curator</span><br></pre></td></tr></table></figure>
<p>或：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zookeeper:&#x2F;&#x2F;10.20.153.10:2181?client&#x3D;curator</span><br></pre></td></tr></table></figure>
<p>需依赖或直接下载：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.netflix.curator&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;curator-framework&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.1.10&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>
<p>Zookeeper 单机配置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:registry address&#x3D;&quot;zookeeper:&#x2F;&#x2F;10.20.153.10:2181&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>或：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:registry protocol&#x3D;&quot;zookeeper&quot; address&#x3D;&quot;10.20.153.10:2181&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>Zookeeper 集群配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:registry address&#x3D;&quot;zookeeper:&#x2F;&#x2F;10.20.153.10:2181?backup&#x3D;10.20.153.11:2181,10.20.153.12:2181&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>或：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:registry protocol&#x3D;&quot;zookeeper&quot; address&#x3D;&quot;10.20.153.10:2181,10.20.153.11:2181,10.20.153.12:2181&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>同一 Zookeeper，分成多组注册中心：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:registry id&#x3D;&quot;chinaRegistry&quot; protocol&#x3D;&quot;zookeeper&quot; address&#x3D;&quot;10.20.153.10:2181&quot; group&#x3D;&quot;china&quot; &#x2F;&gt;</span><br><span class="line">&lt;dubbo:registry id&#x3D;&quot;intlRegistry&quot; protocol&#x3D;&quot;zookeeper&quot; address&#x3D;&quot;10.20.153.10:2181&quot; group&#x3D;&quot;intl&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<h4 id="17-什么是服务熔断？"><a href="#17-什么是服务熔断？" class="headerlink" title="17.什么是服务熔断？"></a>17.什么是服务熔断？</h4><p>答：在应用系统服务中，当依赖服务因访问压力过大而响应变慢或失败，上游服务为了保护系统整体的可用性，临时切断对下游服务的调用。这种牺牲局部，保全整体的措施就叫做熔断。</p>
<h4 id="18-Dubbo-可以对结果进行缓存吗？支持的缓存类型都有哪些？"><a href="#18-Dubbo-可以对结果进行缓存吗？支持的缓存类型都有哪些？" class="headerlink" title="18.Dubbo 可以对结果进行缓存吗？支持的缓存类型都有哪些？"></a>18.Dubbo 可以对结果进行缓存吗？支持的缓存类型都有哪些？</h4><p>答：可以，Dubbo 提供了声明式缓存，用于加速热门数据的访问速度，以减少用户加缓存的工作量。</p>
<p>Dubbo 支持的缓存类型有：</p>
<ul>
<li>lru 基于最近最少使用原则删除多余缓存，保持最热的数据被缓存；</li>
<li>threadlocal 当前线程缓存，比如一个页面渲染，用到很多 portal，每个 portal 都要去查用户信息，通过线程缓存，可以减少这种多余访问；</li>
<li>jcache 集成，可以桥接各种缓存实现。</li>
</ul>
<p>配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">interface</span>=<span class="string">&quot;com.foo.BarService&quot;</span> <span class="attr">cache</span>=<span class="string">&quot;lru&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">interface</span>=<span class="string">&quot;com.foo.BarService&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">&quot;findBar&quot;</span> <span class="attr">cache</span>=<span class="string">&quot;lru&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dubbo:reference</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="19-Dubbo-有几种集群容错模式？"><a href="#19-Dubbo-有几种集群容错模式？" class="headerlink" title="19.Dubbo 有几种集群容错模式？"></a>19.Dubbo 有几种集群容错模式？</h4><p>答：Dubbo 集群容错模式如下。</p>
<h5 id="①-Failover-Cluster"><a href="#①-Failover-Cluster" class="headerlink" title="① Failover Cluster"></a>① Failover Cluster</h5><p>失败自动切换，当出现失败，重试其他服务器。通常用于读操作，但重试会带来更长延迟。可通过 <code>retries=&quot;2&quot;</code> 来设置重试次数（不含第一次）。</p>
<p>重试次数配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">retries</span>=<span class="string">&quot;2&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">retries</span>=<span class="string">&quot;2&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">&quot;findFoo&quot;</span> <span class="attr">retries</span>=<span class="string">&quot;2&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dubbo:reference</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="②-Failfast-Cluster"><a href="#②-Failfast-Cluster" class="headerlink" title="② Failfast Cluster"></a>② Failfast Cluster</h5><p>快速失败，只发起一次调用，失败立即报错。通常用于非幂等性的写操作，比如新增记录。</p>
<h5 id="③-Failsafe-Cluster"><a href="#③-Failsafe-Cluster" class="headerlink" title="③ Failsafe Cluster"></a>③ Failsafe Cluster</h5><p>失败安全，出现异常时，直接忽略。通常用于写入审计日志等操作。</p>
<h5 id="④-Failback-Cluster"><a href="#④-Failback-Cluster" class="headerlink" title="④ Failback Cluster"></a>④ Failback Cluster</h5><p>失败自动恢复，后台记录失败请求，定时重发。通常用于消息通知操作。</p>
<h5 id="⑤-Forking-Cluster"><a href="#⑤-Forking-Cluster" class="headerlink" title="⑤ Forking Cluster"></a>⑤ Forking Cluster</h5><p>并行调用多个服务器，只要一个成功即返回。通常用于实时性要求较高的读操作，但需要浪费更多服务资源。可通过 forks=”2” 来设置最大并行数。</p>
<h5 id="⑥-Broadcast-Cluster"><a href="#⑥-Broadcast-Cluster" class="headerlink" title="⑥ Broadcast Cluster"></a>⑥ Broadcast Cluster</h5><p>广播调用所有提供者，逐个调用，任意一台报错则报错。通常用于通知所有提供者更新缓存或日志等本地资源信息。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/04/%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6%E9%9D%A2%E8%AF%95%E9%A2%98%E5%90%88%E9%9B%86/" data-id="ckke5nr5b009vcl8g4a3t37it" data-title="Java 分布式框架面试题合集" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ms/" rel="tag">ms</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag">分布式</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/4/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/6/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/bug/">bug</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/db/">db</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hello-world/">hello world</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mac/">mac</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mele/">mele</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mq/">mq</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/springCloud/">springCloud</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/springboot/">springboot</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%B6%E4%BB%96/">其他</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7%E7%B1%BB/">工具类</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/">版本控制</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/acid/" rel="tag">acid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aop/" rel="tag">aop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/baby/" rel="tag">baby</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bug/" rel="tag">bug</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dubbo/" rel="tag">dubbo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/excel/" rel="tag">excel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/executors/" rel="tag">executors</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/explain/" rel="tag">explain</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/filter/" rel="tag">filter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/freemarker/" rel="tag">freemarker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/" rel="tag">html</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/httpServerletRequest/" rel="tag">httpServerletRequest</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/httpclient/" rel="tag">httpclient</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/idea/" rel="tag">idea</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/interceptor/" rel="tag">interceptor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ioc/" rel="tag">ioc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ip/" rel="tag">ip</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java%E5%9F%BA%E7%A1%80/" rel="tag">java基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jdbcTemplate/" rel="tag">jdbcTemplate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jdk8-java/" rel="tag">jdk8 - java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/json/" rel="tag">json</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mac/" rel="tag">mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/" rel="tag">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/" rel="tag">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/md/" rel="tag">md</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mele/" rel="tag">mele</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mq/" rel="tag">mq</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ms/" rel="tag">ms</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mybatis/" rel="tag">mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oracle/" rel="tag">oracle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pagehelper-%E5%88%86%E9%A1%B5/" rel="tag">pagehelper - 分页</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/photo/" rel="tag">photo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rabbitmq-mq/" rel="tag">rabbitmq - mq</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis-db/" rel="tag">redis - db</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/" rel="tag">spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springApplication/" rel="tag">springApplication</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springCloud/" rel="tag">springCloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springboot/" rel="tag">springboot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql%E4%BC%98%E5%8C%96/" rel="tag">sql优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stream/" rel="tag">stream</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/struts2/" rel="tag">struts2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swagger/" rel="tag">swagger</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/threadPollExecutor/" rel="tag">threadPollExecutor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/thymeleaf/" rel="tag">thymeleaf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tomcat/" rel="tag">tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tool/" rel="tag">tool</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/war/" rel="tag">war</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webservice/" rel="tag">webservice</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/word/" rel="tag">word</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xml/" rel="tag">xml</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%BB%E9%94%AE/" rel="tag">主键</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%8B%E5%8A%A1/" rel="tag">事务</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81/" rel="tag">代码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%A5%E5%8F%A3%E7%B1%BB/" rel="tag">入口类</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%A5%E9%97%A8/" rel="tag">入门</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%AC%E9%92%A5/" rel="tag">公钥</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag">分布式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E9%A1%B5/" rel="tag">分页</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" rel="tag">单元测试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8E%9F%E7%90%86/" rel="tag">原理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%91%BD%E4%BB%A4/" rel="tag">命令</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B-java/" rel="tag">多线程 - java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AF%BC%E5%87%BA/" rel="tag">导出</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7%E7%B1%BB/" rel="tag">工具类</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B8%B8%E7%94%A8/" rel="tag">常用</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%82%E5%B8%B8/" rel="tag">异常</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%82%E6%AD%A5%E8%B0%83%E7%94%A8/" rel="tag">异步调用</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8A%BD%E8%B1%A1%E7%B1%BB/" rel="tag">抽象类</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8B%A6%E6%88%AA%E5%99%A8/" rel="tag">拦截器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%A5%E5%8F%A3/" rel="tag">接口</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%A5%E5%BF%97/" rel="tag">日志</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A8%A1%E6%9D%BF/" rel="tag">模板</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B3%A8%E8%A7%A3/" rel="tag">注解</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B3%A8%E9%87%8A/" rel="tag">注释</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" rel="tag">消息队列</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%83%AD%E9%83%A8%E7%BD%B2/" rel="tag">热部署</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9B%91%E6%8E%A7/" rel="tag">监控</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0/" rel="tag">箭头函数</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/" rel="tag">线程池</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%93%E5%AD%98/" rel="tag">缓存</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D/" rel="tag">自动装配</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%87%E6%BB%A4%E5%99%A8/" rel="tag">过滤器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%82%AE%E4%BB%B6/" rel="tag">邮件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9B%86%E5%90%88/" rel="tag">集合</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9B%AA%E8%8A%B1%E7%AE%97%E6%B3%95/" rel="tag">雪花算法</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/acid/" style="font-size: 11.67px;">acid</a> <a href="/tags/aop/" style="font-size: 10px;">aop</a> <a href="/tags/baby/" style="font-size: 10px;">baby</a> <a href="/tags/bug/" style="font-size: 11.67px;">bug</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/dubbo/" style="font-size: 10px;">dubbo</a> <a href="/tags/excel/" style="font-size: 10px;">excel</a> <a href="/tags/executors/" style="font-size: 10px;">executors</a> <a href="/tags/explain/" style="font-size: 10px;">explain</a> <a href="/tags/filter/" style="font-size: 10px;">filter</a> <a href="/tags/freemarker/" style="font-size: 10px;">freemarker</a> <a href="/tags/git/" style="font-size: 13.33px;">git</a> <a href="/tags/html/" style="font-size: 10px;">html</a> <a href="/tags/httpServerletRequest/" style="font-size: 10px;">httpServerletRequest</a> <a href="/tags/httpclient/" style="font-size: 10px;">httpclient</a> <a href="/tags/idea/" style="font-size: 10px;">idea</a> <a href="/tags/interceptor/" style="font-size: 10px;">interceptor</a> <a href="/tags/ioc/" style="font-size: 10px;">ioc</a> <a href="/tags/ip/" style="font-size: 10px;">ip</a> <a href="/tags/java/" style="font-size: 18.33px;">java</a> <a href="/tags/java%E5%9F%BA%E7%A1%80/" style="font-size: 11.67px;">java基础</a> <a href="/tags/jdbcTemplate/" style="font-size: 10px;">jdbcTemplate</a> <a href="/tags/jdk8-java/" style="font-size: 10px;">jdk8 - java</a> <a href="/tags/js/" style="font-size: 10px;">js</a> <a href="/tags/json/" style="font-size: 10px;">json</a> <a href="/tags/linux/" style="font-size: 13.33px;">linux</a> <a href="/tags/mac/" style="font-size: 10px;">mac</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/md/" style="font-size: 10px;">md</a> <a href="/tags/mele/" style="font-size: 10px;">mele</a> <a href="/tags/mq/" style="font-size: 11.67px;">mq</a> <a href="/tags/ms/" style="font-size: 11.67px;">ms</a> <a href="/tags/mybatis/" style="font-size: 15px;">mybatis</a> <a href="/tags/oracle/" style="font-size: 11.67px;">oracle</a> <a href="/tags/pagehelper-%E5%88%86%E9%A1%B5/" style="font-size: 10px;">pagehelper - 分页</a> <a href="/tags/photo/" style="font-size: 10px;">photo</a> <a href="/tags/rabbitmq-mq/" style="font-size: 10px;">rabbitmq - mq</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/redis-db/" style="font-size: 10px;">redis - db</a> <a href="/tags/spring/" style="font-size: 11.67px;">spring</a> <a href="/tags/springApplication/" style="font-size: 10px;">springApplication</a> <a href="/tags/springCloud/" style="font-size: 11.67px;">springCloud</a> <a href="/tags/springboot/" style="font-size: 20px;">springboot</a> <a href="/tags/sql%E4%BC%98%E5%8C%96/" style="font-size: 10px;">sql优化</a> <a href="/tags/stream/" style="font-size: 10px;">stream</a> <a href="/tags/struts2/" style="font-size: 10px;">struts2</a> <a href="/tags/swagger/" style="font-size: 10px;">swagger</a> <a href="/tags/threadPollExecutor/" style="font-size: 10px;">threadPollExecutor</a> <a href="/tags/thymeleaf/" style="font-size: 10px;">thymeleaf</a> <a href="/tags/tomcat/" style="font-size: 11.67px;">tomcat</a> <a href="/tags/tool/" style="font-size: 13.33px;">tool</a> <a href="/tags/war/" style="font-size: 10px;">war</a> <a href="/tags/webservice/" style="font-size: 10px;">webservice</a> <a href="/tags/word/" style="font-size: 10px;">word</a> <a href="/tags/xml/" style="font-size: 11.67px;">xml</a> <a href="/tags/%E4%B8%BB%E9%94%AE/" style="font-size: 10px;">主键</a> <a href="/tags/%E4%BA%8B%E5%8A%A1/" style="font-size: 11.67px;">事务</a> <a href="/tags/%E4%BB%A3%E7%A0%81/" style="font-size: 10px;">代码</a> <a href="/tags/%E5%85%A5%E5%8F%A3%E7%B1%BB/" style="font-size: 10px;">入口类</a> <a href="/tags/%E5%85%A5%E9%97%A8/" style="font-size: 11.67px;">入门</a> <a href="/tags/%E5%85%AC%E9%92%A5/" style="font-size: 10px;">公钥</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 11.67px;">分布式</a> <a href="/tags/%E5%88%86%E9%A1%B5/" style="font-size: 10px;">分页</a> <a href="/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">单元测试</a> <a href="/tags/%E5%8E%9F%E7%90%86/" style="font-size: 10px;">原理</a> <a href="/tags/%E5%91%BD%E4%BB%A4/" style="font-size: 10px;">命令</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B-java/" style="font-size: 10px;">多线程 - java</a> <a href="/tags/%E5%AF%BC%E5%87%BA/" style="font-size: 10px;">导出</a> <a href="/tags/%E5%B7%A5%E5%85%B7%E7%B1%BB/" style="font-size: 16.67px;">工具类</a> <a href="/tags/%E5%B8%B8%E7%94%A8/" style="font-size: 10px;">常用</a> <a href="/tags/%E5%BC%82%E5%B8%B8/" style="font-size: 10px;">异常</a> <a href="/tags/%E5%BC%82%E6%AD%A5%E8%B0%83%E7%94%A8/" style="font-size: 10px;">异步调用</a> <a href="/tags/%E6%8A%BD%E8%B1%A1%E7%B1%BB/" style="font-size: 10px;">抽象类</a> <a href="/tags/%E6%8B%A6%E6%88%AA%E5%99%A8/" style="font-size: 10px;">拦截器</a> <a href="/tags/%E6%8E%A5%E5%8F%A3/" style="font-size: 10px;">接口</a> <a href="/tags/%E6%97%A5%E5%BF%97/" style="font-size: 11.67px;">日志</a> <a href="/tags/%E6%A8%A1%E6%9D%BF/" style="font-size: 10px;">模板</a> <a href="/tags/%E6%B3%A8%E8%A7%A3/" style="font-size: 10px;">注解</a> <a href="/tags/%E6%B3%A8%E9%87%8A/" style="font-size: 10px;">注释</a> <a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 10px;">消息队列</a> <a href="/tags/%E7%83%AD%E9%83%A8%E7%BD%B2/" style="font-size: 10px;">热部署</a> <a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 10px;">监控</a> <a href="/tags/%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0/" style="font-size: 10px;">箭头函数</a> <a href="/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/" style="font-size: 11.67px;">线程池</a> <a href="/tags/%E7%BC%93%E5%AD%98/" style="font-size: 10px;">缓存</a> <a href="/tags/%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D/" style="font-size: 10px;">自动装配</a> <a href="/tags/%E8%BF%87%E6%BB%A4%E5%99%A8/" style="font-size: 10px;">过滤器</a> <a href="/tags/%E9%82%AE%E4%BB%B6/" style="font-size: 10px;">邮件</a> <a href="/tags/%E9%9B%86%E5%90%88/" style="font-size: 10px;">集合</a> <a href="/tags/%E9%9B%AA%E8%8A%B1%E7%AE%97%E6%B3%95/" style="font-size: 10px;">雪花算法</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/01/23/redis%E6%95%99%E7%A8%8B%E6%95%88%E7%8E%87%E7%89%88/">redis入门效率版</a>
          </li>
        
          <li>
            <a href="/2021/01/22/%E5%BC%80%E5%8F%91%E6%B3%A8%E6%84%8F%E4%BB%A3%E7%A0%81%E6%95%B4%E7%90%86/">开发中注意的小问题</a>
          </li>
        
          <li>
            <a href="/2021/01/02/SQL%E8%AF%AD%E5%8F%A5%E6%80%A7%E8%83%BD%E6%8F%90%E5%8D%87/">SQL语句性能提升</a>
          </li>
        
          <li>
            <a href="/2020/12/15/%E9%9B%86%E5%90%88%E5%88%86%E9%A1%B5%E5%B7%A5%E5%85%B7%E7%B1%BB/">集合分页工具类</a>
          </li>
        
          <li>
            <a href="/2020/12/10/%E5%8F%AA%E4%BF%AE%E6%94%B9%E5%87%A0%E8%A1%8C%EF%BC%8Cgit%E5%8D%B4%E6%98%BE%E7%A4%BA%E6%95%B4%E4%B8%AA%E6%96%87%E4%BB%B6%E9%83%BD%E8%A2%AB%E4%BF%AE%E6%94%B9/">只修改几行，git却显示整个文件都被修改</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>